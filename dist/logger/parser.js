var tm=Object.create;var Ne=Object.defineProperty;var nm=Object.getOwnPropertyDescriptor;var om=Object.getOwnPropertyNames;var am=Object.getPrototypeOf,sm=Object.prototype.hasOwnProperty;var im=(t,e,n)=>e in t?Ne(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var rm=(t,e)=>{for(var n in e)Ne(t,n,{get:e[n],enumerable:!0})},Ur=(t,e,n,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of om(e))!sm.call(t,s)&&s!==n&&Ne(t,s,{get:()=>e[s],enumerable:!(o=nm(e,s))||o.enumerable});return t};var um=(t,e,n)=>(n=t!=null?tm(am(t)):{},Ur(e||!t||!t.__esModule?Ne(n,"default",{value:t,enumerable:!0}):n,t)),mm=t=>Ur(Ne({},"__esModule",{value:!0}),t);var $=(t,e,n)=>(im(t,typeof e!="symbol"?e+"":e,n),n),_n=(t,e,n)=>{if(!e.has(t))throw TypeError("Cannot "+n)};var g=(t,e,n)=>(_n(t,e,"read from private field"),n?n.call(t):e.get(t)),Q=(t,e,n)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},ne=(t,e,n,o)=>(_n(t,e,"write to private field"),o?o.call(t,n):e.set(t,n),n);var he=(t,e,n)=>(_n(t,e,"access private method"),n);var n_={};rm(n_,{Parser:()=>Fr});module.exports=mm(n_);var yu=require("tiny-typed-emitter");var ie=(d=>(d[d.none=0]="none",d[d.slot=1]="slot",d[d.stat=2]="stat",d[d.ability_point=3]="ability_point",d[d.combat_effect=4]="combat_effect",d[d.skill_damage=5]="skill_damage",d[d.skill_critical_ratio=6]="skill_critical_ratio",d[d.skill_critical_damage=7]="skill_critical_damage",d[d.skill_penetration=8]="skill_penetration",d[d.npc_grade_less_damage=9]="npc_grade_less_damage",d[d.npc_grade_less_critical_ratio=10]="npc_grade_less_critical_ratio",d[d.npc_grade_less_critical_damage=11]="npc_grade_less_critical_damage",d[d.npc_grade_less_penetration=12]="npc_grade_less_penetration",d[d.npc_grade_greater_damage=13]="npc_grade_greater_damage",d[d.npc_grade_greater_critical_ratio=14]="npc_grade_greater_critical_ratio",d[d.npc_grade_greater_critical_damage=15]="npc_grade_greater_critical_damage",d[d.npc_grade_greater_penetration=16]="npc_grade_greater_penetration",d[d.npc_species_damage=17]="npc_species_damage",d[d.npc_species_critical_ratio=18]="npc_species_critical_ratio",d[d.npc_species_critical_damage=19]="npc_species_critical_damage",d[d.npc_species_penetration=20]="npc_species_penetration",d[d.npc_attr_damage=21]="npc_attr_damage",d[d.npc_attr_critical_ratio=22]="npc_attr_critical_ratio",d[d.npc_attr_critical_damage=23]="npc_attr_critical_damage",d[d.npc_attr_penetration=24]="npc_attr_penetration",d[d.mana_reduction=25]="mana_reduction",d[d.skill_mana_reduction=26]="skill_mana_reduction",d[d.skill_cooldown_reduction=27]="skill_cooldown_reduction",d[d.ability_feature=28]="ability_feature",d[d.class_option=29]="class_option",d[d.ability_point_passive=30]="ability_point_passive",d[d.instrument=31]="instrument",d[d.skill_feature=32]="skill_feature",d[d.npc_adaptation=33]="npc_adaptation",d[d.skill_group_damage=34]="skill_group_damage",d[d.skill_group_cooldown_reduction=35]="skill_group_cooldown_reduction",d[d.skill_level=36]="skill_level",d[d.skill_feature_level=37]="skill_feature_level",d[d.life_casting_speed=38]="life_casting_speed",d[d.life_casting_tier=39]="life_casting_tier",d[d.life_bonus_type_success=40]="life_bonus_type_success",d[d.life_bonus_type_extra=41]="life_bonus_type_extra",d[d.life_bonus_type_skill_bonus=42]="life_bonus_type_skill_bonus",d[d.life_bonus_type_minigame_perfect=43]="life_bonus_type_minigame_perfect",d[d.life_durability_bonus=44]="life_durability_bonus",d[d.life_mini_game_difficulty=45]="life_mini_game_difficulty",d[d.combat_effect_cooldown_reduction=46]="combat_effect_cooldown_reduction",d[d.skill_damage_addend=47]="skill_damage_addend",d[d.awakening_usable_count_addend=48]="awakening_usable_count_addend",d[d.battle_item_heal=49]="battle_item_heal",d[d.party_heal=50]="party_heal",d[d.party_shield=51]="party_shield",d[d.identity_gauge=52]="identity_gauge",d[d.attack_power_amplify_addend=53]="attack_power_amplify_addend",d[d.attack_power_amplify_multiplier=54]="attack_power_amplify_multiplier",d[d.not_in_party_damage=55]="not_in_party_damage",d[d.skill_effect_group_set_damage=56]="skill_effect_group_set_damage",d))(ie||{});var Ot=(b=>(b[b.none=0]="none",b[b.modify_damage=1]="modify_damage",b[b.modify_final_damage=2]="modify_final_damage",b[b.modify_critical_ratio=3]="modify_critical_ratio",b[b.modify_critical_multiplier=4]="modify_critical_multiplier",b[b.modify_penetration=5]="modify_penetration",b[b.modify_penetration_when_critical=6]="modify_penetration_when_critical",b[b.exec_active_effect_when_damage=7]="exec_active_effect_when_damage",b[b.exec_active_effect_when_critical=8]="exec_active_effect_when_critical",b[b.exec_reactive_effect_when_miss=9]="exec_reactive_effect_when_miss",b[b.exec_reactive_effect_when_damage=10]="exec_reactive_effect_when_damage",b[b.exec_reactive_effect_when_critical=11]="exec_reactive_effect_when_critical",b[b.exec_after_effect=12]="exec_after_effect",b[b.exec_after_skill=13]="exec_after_skill",b[b.apply_heal=14]="apply_heal",b[b.modify_reactive_damage=15]="modify_reactive_damage",b[b.modify_damage_shield_multiplier=16]="modify_damage_shield_multiplier",b[b.exec_active_effect_when_kill=17]="exec_active_effect_when_kill",b[b.exec_start_skill=18]="exec_start_skill",b[b.modify_penetration_addend=19]="modify_penetration_addend",b[b.modify_penetration_addend_when_critical=20]="modify_penetration_addend_when_critical",b[b.modify_reactive_critical_multiplier=21]="modify_reactive_critical_multiplier",b[b.modify_damage_when_critical=22]="modify_damage_when_critical",b[b.modify_paralyzation_point=23]="modify_paralyzation_point",b[b.exec_when_counter=24]="exec_when_counter",b[b.exec_when_be_killed=25]="exec_when_be_killed",b))(Ot||{});var ln=(h=>(h[h.none=0]="none",h[h.underling=1]="underling",h[h.normal=2]="normal",h[h.elite=3]="elite",h[h.named=4]="named",h[h.seed=5]="seed",h[h.boss=6]="boss",h[h.raid=7]="raid",h[h.lucky=8]="lucky",h[h.epic_raid=9]="epic_raid",h[h.commander=10]="commander",h))(ln||{});var Ft=(n=>(n[n.absolute=0]="absolute",n[n.relative=1]="relative",n))(Ft||{});var qt=(u=>(u[u.none=0]="none",u[u.enable_notify=1]="enable_notify",u[u.enable_dir_change=2]="enable_dir_change",u[u.change_move_dist=3]="change_move_dist",u[u.change_layer=4]="change_layer",u[u.change_stage_speed=5]="change_stage_speed",u[u.change_stage_collision=6]="change_stage_collision",u[u.change_max_target=7]="change_max_target",u[u.change_area_range=8]="change_area_range",u[u.change_area_angle=9]="change_area_angle",u[u.change_cost=10]="change_cost",u[u.recover_cost=11]="recover_cost",u[u.recover_used_cost=12]="recover_used_cost",u[u.reduce_default_cooldown=13]="reduce_default_cooldown",u[u.reduce_active_cooldown=14]="reduce_active_cooldown",u[u.enable_stage_buff=15]="enable_stage_buff",u[u.add_stage_buff=16]="add_stage_buff",u[u.change_buff_area_range=17]="change_buff_area_range",u[u.change_buff_duration=18]="change_buff_duration",u[u.change_buff_stat=19]="change_buff_stat",u[u.change_buff_stack=20]="change_buff_stack",u[u.change_buff_param=21]="change_buff_param",u[u.change_buff_expired_action=22]="change_buff_expired_action",u[u.change_chain_ratio=23]="change_chain_ratio",u[u.change_abnormal=24]="change_abnormal",u[u.change_abnormal_ratio=25]="change_abnormal_ratio",u[u.change_dam_attr=26]="change_dam_attr",u[u.change_dam_value=27]="change_dam_value",u[u.change_dam_coefficient=28]="change_dam_coefficient",u[u.change_dam_critical=29]="change_dam_critical",u[u.change_dam_critical_rate=30]="change_dam_critical_rate",u[u.change_attack_stage_speed=31]="change_attack_stage_speed",u[u.change_stack_charge_time=32]="change_stack_charge_time",u[u.change_stack_max_count=33]="change_stack_max_count",u[u.change_targeting=34]="change_targeting",u[u.change_min_range=35]="change_min_range",u[u.change_max_range=36]="change_max_range",u[u.change_push_info=37]="change_push_info",u[u.change_parts_attack_attr=38]="change_parts_attack_attr",u[u.change_skill_chain_info=39]="change_skill_chain_info",u[u.change_skill_chain_delay=40]="change_skill_chain_delay",u[u.change_behit_move_info=41]="change_behit_move_info",u[u.add_buff_stat=42]="add_buff_stat",u[u.add_chain_skill_effect=43]="add_chain_skill_effect",u[u.remove_chain_skill_effect=44]="remove_chain_skill_effect",u[u.add_chain_combat_effect=45]="add_chain_combat_effect",u[u.remove_chain_combat_effect=46]="remove_chain_combat_effect",u[u.change_skill_effect_bonus=47]="change_skill_effect_bonus",u[u.change_skill_effect_ai_point=48]="change_skill_effect_ai_point",u[u.change_dam_addend=49]="change_dam_addend",u[u.change_hitted=50]="change_hitted",u[u.change_skill_move_speed=51]="change_skill_move_speed",u[u.add_skill_buff=52]="add_skill_buff",u[u.change_skill_bonus=53]="change_skill_bonus",u[u.change_skill_normal_info=54]="change_skill_normal_info",u[u.change_skill_invisibility=55]="change_skill_invisibility",u[u.change_skill_constraint=56]="change_skill_constraint",u[u.change_skill_book_type=57]="change_skill_book_type",u[u.change_projection_skill_effect_id=58]="change_projection_skill_effect_id",u[u.change_push_pvp_info=59]="change_push_pvp_info",u[u.change_forced_critical=60]="change_forced_critical",u[u.change_instance_skill_effect_info=61]="change_instance_skill_effect_info",u[u.change_skill_start_stage=62]="change_skill_start_stage",u[u.change_skill_effect_dir_target=63]="change_skill_effect_dir_target",u[u.change_stage_dir_rate=64]="change_stage_dir_rate",u[u.change_projection=65]="change_projection",u[u.change_skill_view=66]="change_skill_view",u[u.change_projectile_speed=67]="change_projectile_speed",u[u.change_projectile_dist=68]="change_projectile_dist",u[u.change_projectile_resourcescale=69]="change_projectile_resourcescale",u[u.change_projectile_max_target_hit_count=70]="change_projectile_max_target_hit_count",u[u.change_summon_trap_lifetime=71]="change_summon_trap_lifetime",u[u.change_summon_trap_destroy_delaytime=72]="change_summon_trap_destroy_delaytime",u[u.change_summon_trap_react_info=73]="change_summon_trap_react_info",u[u.change_summon_trap_invoke_effect=74]="change_summon_trap_invoke_effect",u[u.change_summon_trap_count=75]="change_summon_trap_count",u[u.enable_identity_event=76]="enable_identity_event",u[u.change_identity_proc_value=77]="change_identity_proc_value",u[u.change_skill_effect_identity_proc_info=78]="change_skill_effect_identity_proc_info",u[u.change_identity_proc_pvp_value=79]="change_identity_proc_pvp_value",u[u.change_skill_effect_identity_proc_pvp_info=80]="change_skill_effect_identity_proc_pvp_info",u[u.change_skill_effect_identity_proc_replace_info=81]="change_skill_effect_identity_proc_replace_info",u[u.change_skill_effect_identity_proc_replace_pvp_info=82]="change_skill_effect_identity_proc_replace_pvp_info",u[u.swap_chain_skill_effect=83]="swap_chain_skill_effect",u[u.swap_chain_combat_effect=84]="swap_chain_combat_effect",u[u.change_charge_scale=85]="change_charge_scale",u[u.change_summon_npc_id=86]="change_summon_npc_id",u[u.change_summon_npc_sight_range=87]="change_summon_npc_sight_range",u[u.change_summon_npc_pursuit_range=88]="change_summon_npc_pursuit_range",u[u.change_summon_npc_walk_movespeed=89]="change_summon_npc_walk_movespeed",u[u.change_summon_npc_battle_movespeed=90]="change_summon_npc_battle_movespeed",u[u.change_summon_npc_life_time=91]="change_summon_npc_life_time",u[u.change_summon_npc_ai_index=92]="change_summon_npc_ai_index",u[u.change_summon_npc_invincible_duration=93]="change_summon_npc_invincible_duration",u[u.change_summon_npc_acquire_identity=94]="change_summon_npc_acquire_identity",u[u.change_summon_npc_skill_id=95]="change_summon_npc_skill_id",u[u.change_summon_npc_die_skill_id=96]="change_summon_npc_die_skill_id",u[u.change_summon_npc_destroy_skill_id=97]="change_summon_npc_destroy_skill_id",u[u.change_summon_npc_spawn_buff_id=98]="change_summon_npc_spawn_buff_id",u[u.change_summon_npc_count=99]="change_summon_npc_count",u[u.change_summon_npc_stat=100]="change_summon_npc_stat",u[u.change_summon_npc_threat_point=101]="change_summon_npc_threat_point",u[u.change_summon_npc_skill_usable_tick=102]="change_summon_npc_skill_usable_tick",u[u.change_summon_npc_skill_use_order=103]="change_summon_npc_skill_use_order",u[u.change_combat_effect_arg=104]="change_combat_effect_arg",u[u.change_skill_effect_cost=105]="change_skill_effect_cost",u[u.change_accumulate_dam_rate=106]="change_accumulate_dam_rate",u[u.change_projectile_bank_data_addend=107]="change_projectile_bank_data_addend",u[u.change_identity_category=108]="change_identity_category",u[u.change_skill_slot_visible_effect=109]="change_skill_slot_visible_effect",u[u.change_attack_mask=110]="change_attack_mask",u[u.change_aim_target_max_range=111]="change_aim_target_max_range",u))(qt||{}),Se=(r=>(r[r.none=0]="none",r[r.hp=1]="hp",r[r.mp=2]="mp",r[r.str=3]="str",r[r.agi=4]="agi",r[r.int=5]="int",r[r.con=6]="con",r[r.str_x=7]="str_x",r[r.agi_x=8]="agi_x",r[r.int_x=9]="int_x",r[r.con_x=10]="con_x",r[r.criticalhit=15]="criticalhit",r[r.specialty=16]="specialty",r[r.oppression=17]="oppression",r[r.rapidity=18]="rapidity",r[r.endurance=19]="endurance",r[r.mastery=20]="mastery",r[r.criticalhit_x=21]="criticalhit_x",r[r.specialty_x=22]="specialty_x",r[r.oppression_x=23]="oppression_x",r[r.rapidity_x=24]="rapidity_x",r[r.endurance_x=25]="endurance_x",r[r.mastery_x=26]="mastery_x",r[r.max_hp=27]="max_hp",r[r.max_mp=28]="max_mp",r[r.max_hp_x=29]="max_hp_x",r[r.max_mp_x=30]="max_mp_x",r[r.max_hp_x_x=31]="max_hp_x_x",r[r.max_mp_x_x=32]="max_mp_x_x",r[r.normal_hp_recovery=33]="normal_hp_recovery",r[r.combat_hp_recovery=34]="combat_hp_recovery",r[r.normal_hp_recovery_rate=35]="normal_hp_recovery_rate",r[r.combat_hp_recovery_rate=36]="combat_hp_recovery_rate",r[r.normal_mp_recovery=37]="normal_mp_recovery",r[r.combat_mp_recovery=38]="combat_mp_recovery",r[r.normal_mp_recovery_rate=39]="normal_mp_recovery_rate",r[r.combat_mp_recovery_rate=40]="combat_mp_recovery_rate",r[r.self_recovery_rate=41]="self_recovery_rate",r[r.drain_hp_dam_rate=42]="drain_hp_dam_rate",r[r.drain_mp_dam_rate=43]="drain_mp_dam_rate",r[r.dam_reflection_rate=44]="dam_reflection_rate",r[r.char_attack_dam=47]="char_attack_dam",r[r.skill_effect_dam_addend=48]="skill_effect_dam_addend",r[r.attack_power_rate=49]="attack_power_rate",r[r.skill_damage_rate=50]="skill_damage_rate",r[r.attack_power_rate_x=51]="attack_power_rate_x",r[r.skill_damage_rate_x=52]="skill_damage_rate_x",r[r.cooldown_reduction=53]="cooldown_reduction",r[r.paralyzation_point_rate=54]="paralyzation_point_rate",r[r.def=55]="def",r[r.res=56]="res",r[r.def_x=57]="def_x",r[r.res_x=58]="res_x",r[r.def_x_x=59]="def_x_x",r[r.res_x_x=60]="res_x_x",r[r.critical_physical_inc_rate=65]="critical_physical_inc_rate",r[r.critical_magical_inc_rate=66]="critical_magical_inc_rate",r[r.def_pen_rate=67]="def_pen_rate",r[r.res_pen_rate=68]="res_pen_rate",r[r.physical_inc_rate=69]="physical_inc_rate",r[r.magical_inc_rate=70]="magical_inc_rate",r[r.self_shield_rate=71]="self_shield_rate",r[r.hit_rate=72]="hit_rate",r[r.dodge_rate=73]="dodge_rate",r[r.critical_hit_rate=74]="critical_hit_rate",r[r.critical_res_rate=75]="critical_res_rate",r[r.critical_dam_rate=76]="critical_dam_rate",r[r.attack_speed=77]="attack_speed",r[r.attack_speed_rate=78]="attack_speed_rate",r[r.move_speed=79]="move_speed",r[r.move_speed_rate=80]="move_speed_rate",r[r.prop_move_speed=81]="prop_move_speed",r[r.prop_move_speed_rate=82]="prop_move_speed_rate",r[r.vehicle_move_speed=83]="vehicle_move_speed",r[r.vehicle_move_speed_rate=84]="vehicle_move_speed_rate",r[r.ship_move_speed=85]="ship_move_speed",r[r.ship_move_speed_rate=86]="ship_move_speed_rate",r[r.fire_dam_rate=87]="fire_dam_rate",r[r.ice_dam_rate=88]="ice_dam_rate",r[r.electricity_dam_rate=89]="electricity_dam_rate",r[r.earth_dam_rate=91]="earth_dam_rate",r[r.dark_dam_rate=92]="dark_dam_rate",r[r.holy_dam_rate=93]="holy_dam_rate",r[r.elements_dam_rate=94]="elements_dam_rate",r[r.fire_res_rate=95]="fire_res_rate",r[r.ice_res_rate=96]="ice_res_rate",r[r.electricity_res_rate=97]="electricity_res_rate",r[r.earth_res_rate=99]="earth_res_rate",r[r.dark_res_rate=100]="dark_res_rate",r[r.holy_res_rate=101]="holy_res_rate",r[r.elements_res_rate=102]="elements_res_rate",r[r.self_cc_time_rate=105]="self_cc_time_rate",r[r.enemy_cc_time_rate=106]="enemy_cc_time_rate",r[r.identity_value1=107]="identity_value1",r[r.identity_value2=108]="identity_value2",r[r.identity_value3=109]="identity_value3",r[r.awakening_dam_rate=110]="awakening_dam_rate",r[r.item_drop_rate=111]="item_drop_rate",r[r.gold_rate=112]="gold_rate",r[r.exp_rate=113]="exp_rate",r[r.attack_power_addend=123]="attack_power_addend",r[r.attack_power_addend_2=124]="attack_power_addend_2",r[r.npc_species_humanoid_dam_rate=125]="npc_species_humanoid_dam_rate",r[r.npc_species_devil_dam_rate=126]="npc_species_devil_dam_rate",r[r.npc_species_substance_dam_rate=127]="npc_species_substance_dam_rate",r[r.npc_species_undead_dam_rate=128]="npc_species_undead_dam_rate",r[r.npc_species_plant_dam_rate=129]="npc_species_plant_dam_rate",r[r.npc_species_insect_dam_rate=130]="npc_species_insect_dam_rate",r[r.npc_species_spirit_dam_rate=131]="npc_species_spirit_dam_rate",r[r.npc_species_wild_beast_dam_rate=132]="npc_species_wild_beast_dam_rate",r[r.npc_species_mechanic_dam_rate=133]="npc_species_mechanic_dam_rate",r[r.npc_species_ancient_dam_rate=134]="npc_species_ancient_dam_rate",r[r.npc_species_god_dam_rate=135]="npc_species_god_dam_rate",r[r.npc_species_archfiend_dam_rate=136]="npc_species_archfiend_dam_rate",r[r.vitality=137]="vitality",r[r.ship_booter_speed=138]="ship_booter_speed",r[r.ship_wreck_speed_rate=139]="ship_wreck_speed_rate",r[r.island_speed_rate=140]="island_speed_rate",r[r.attack_power_sub_rate_1=141]="attack_power_sub_rate_1",r[r.attack_power_sub_rate_2=142]="attack_power_sub_rate_2",r[r.physical_inc_sub_rate_1=143]="physical_inc_sub_rate_1",r[r.physical_inc_sub_rate_2=144]="physical_inc_sub_rate_2",r[r.magical_inc_sub_rate_1=145]="magical_inc_sub_rate_1",r[r.magical_inc_sub_rate_2=146]="magical_inc_sub_rate_2",r[r.skill_damage_sub_rate_1=147]="skill_damage_sub_rate_1",r[r.skill_damage_sub_rate_2=148]="skill_damage_sub_rate_2",r[r.resource_recovery_rate=149]="resource_recovery_rate",r[r.weapon_dam=151]="weapon_dam",r[r.weapon_dam_x=152]="weapon_dam_x",r))(Se||{});var De=(a=>(a[a.normal=0]="normal",a[a.hard=1]="hard",a[a.hellchaos=2]="hellchaos",a[a.challenge=3]="challenge",a[a.special=4]="special",a[a.extreme=5]="extreme",a))(De||{});var Vr=require("tiny-typed-emitter");var Y,Re,U,we,fn,ke,Wt,cn=class extends Vr.TypedEmitter{constructor(n,o,s=!0,i=!!process.env.DEV){super();Q(this,we);Q(this,ke);$(this,"PartyStatusEffectRegistry");$(this,"LocalStatusEffectRegistry");Q(this,Y,void 0);Q(this,Re,void 0);Q(this,U,void 0);$(this,"debug");$(this,"trace",!1);this.PartyStatusEffectRegistry=new Map,this.LocalStatusEffectRegistry=new Map,this.debug=i,ne(this,Y,n),ne(this,Re,o),ne(this,U,s)}getStatusEffectRegistryForPlayer(n,o){let s=this.getPlayerRegistry(o),i=s.get(n);if(i)return i;let a=new Map;return s.set(n,a),a}hasStatusEffectRegistryForPlayer(n,o){return this.getPlayerRegistry(o).has(n)}getPlayerRegistry(n){switch(n){case 1:return this.LocalStatusEffectRegistry;case 0:return this.PartyStatusEffectRegistry;default:break}return this.LocalStatusEffectRegistry}RemoveLocalObject(n,o){let s=this.LocalStatusEffectRegistry.get(n);if(s)for(let[,i]of s)this.RemoveStatusEffect(n,i.instanceId,1,void 0,o);this.LocalStatusEffectRegistry.delete(n)}RemovePartyObject(n,o){let s=this.PartyStatusEffectRegistry.get(n);if(s)for(let[,i]of s)this.RemoveStatusEffect(n,i.instanceId,0,void 0,o);this.PartyStatusEffectRegistry.delete(n)}RegisterStatusEffect(n){let o=this.getStatusEffectRegistryForPlayer(n.targetId,n.type),s=o.get(n.instanceId);s?g(this,U)&&s.expirationTimer&&(clearTimeout(s.expirationTimer),s.expirationTimer=void 0):n.effectType===0&&this.emit("shieldApplied",n),o.set(n.instanceId,n),this.SetupStatusEffectTimeout(n)}HasAnyStatusEffect(n,o,s,i){if(!this.hasStatusEffectRegistryForPlayer(n,o))return!1;let a=this.getStatusEffectRegistryForPlayer(n,o);for(let[,m]of a)if(!(!g(this,U)&&!this.IsReplayStatusEffectValidElseRemove(m,i))){for(let c of s)if(c===m.statusEffectId)return!0}return!1}IsReplayStatusEffectValidElseRemove(n,o){return n.expireAt===void 0||n.expireAt.getTime()>o.getTime()?!0:(this.ExpireStatusEffectByTimeout(n),!1)}HasAnyStatusEffectFromParty(n,o,s,i,a){if(!this.hasStatusEffectRegistryForPlayer(n,o))return!1;let m=this.getStatusEffectRegistryForPlayer(n,o);for(let[,c]of m)if(!(!g(this,U)&&!this.IsReplayStatusEffectValidElseRemove(c,a))&&i.includes(c.statusEffectId)){let l=g(this,Y).getPartyIdFromEntityId(c.sourceId);if(this.ValidForWholeRaid(c))return l!==void 0;if(l===s)return!0}return!1}RemoveStatusEffect(n,o,s,i,a){if(!this.hasStatusEffectRegistryForPlayer(n,s))return;let m=this.getStatusEffectRegistryForPlayer(n,s),c=m.get(o);return c&&(g(this,U)&&(clearTimeout(c.expirationTimer),c.expirationTimer=void 0),m.delete(o),i===4&&(g(this,U)||this.IsReplayStatusEffectValidElseRemove(c,a))&&this.RegisterValueUpdate(c,c.value,0)),c}GetStatusEffects(n,o,s,i){if(!this.hasStatusEffectRegistryForPlayer(n,o))return[];let a=this.getStatusEffectRegistryForPlayer(n,o);if(!g(this,U))for(let[,c]of a)this.IsReplayStatusEffectValidElseRemove(c,s);let m=[...a.values()];return i!==void 0?m.filter((c,l,k)=>c.sourceId===i):m}GetStatusEffectsFromParty(n,o,s,i){if(!this.hasStatusEffectRegistryForPlayer(n,o))return[];let a=this.getStatusEffectRegistryForPlayer(n,o);if(!g(this,U))for(let[,m]of a)this.IsReplayStatusEffectValidElseRemove(m,i);return[...a.values()].filter(m=>this.ValidForWholeRaid(m)?g(this,Y).getPartyIdFromEntityId(m.sourceId)!==void 0:s===g(this,Y).getPartyIdFromEntityId(m.sourceId))}Clear(n){let o=0;for(let[,i]of this.LocalStatusEffectRegistry){for(let[,a]of i)this.RemoveStatusEffect(a.targetId,a.instanceId,a.type,void 0,n);o+=i.size}let s=0;for(let[,i]of this.PartyStatusEffectRegistry){for(let[,a]of i)this.RemoveStatusEffect(a.targetId,a.instanceId,a.type,void 0,n);s+=i.size}this.trace&&console.log("On Clear SE in local",o,"in party",s),this.LocalStatusEffectRegistry.clear(),this.PartyStatusEffectRegistry.clear()}UpdateDuration(n,o,s,i){let m=this.getStatusEffectRegistryForPlayer(o,i).get(n);if(m){let c=s-m.timestamp;if(g(this,U)&&m.expirationTimer&&(this.trace&&console.log("Clearing timeout for",m.instanceId,"because of duration change"),clearTimeout(m.expirationTimer),m.expirationTimer=void 0),m.expireAt){let l=m.expireAt.getTime()+Number(c),k=l-m.pktTime.getTime();k>0?(this.trace&&console.log("Extending duration by",c,"ms","New timeout delay",k,"from",m.expireAt.toISOString(),"to",new Date(l).toISOString()),g(this,U)&&(m.expirationTimer=setTimeout(this.ExpireStatusEffectByTimeout.bind(this,m),k)),m.expireAt=new Date(l),m.timestamp=s):m.expireAt=void 0}}else this.debug&&console.error("Tried to update duration for SE with instanceId",n," on target",o,"but where is no such SE registered")}SyncStatusEffect(n,o,s,i,a){let m=he(this,ke,Wt).call(this,o,a),c=m?0:1,l=m?o:s;if(!l)return;let h=this.getStatusEffectRegistryForPlayer(l,c).get(n);if(!h)return;let v=h.value;h.value=i,this.RegisterValueUpdate(h,v,i)}ValidForWholeRaid(n){return(n.buffCategory===3||n.buffCategory===1||n.buffCategory===2)&&n.category===1&&n.showType===1}SetupStatusEffectTimeout(n){if(n.expirationDelay>0&&n.expirationDelay<604800){let o=n.pktTime.getTime()>n.occurTime.getTime()?n.pktTime:n.occurTime,s=Math.ceil(n.expirationDelay*1e3),i=o.getTime()+s+cn.TIMEOUT_DELAY_MS-n.pktTime.getTime();n.expireAt=new Date(n.pktTime.getTime()+i),this.trace&&console.log("Setting up statuseffect expiration time for",n.name,n.instanceId,"to",n.expireAt.toISOString(),"with delay",i),g(this,U)&&(n.expirationTimer=setTimeout(this.ExpireStatusEffectByTimeout.bind(this,n),i))}}ExpireStatusEffectByTimeout(n){this.debug&&console.error("Triggered timeout on",n.name,"with iid",n.instanceId),this.RemoveStatusEffect(n.targetId,n.instanceId,n.type,void 0,new Date)}RegisterValueUpdate(n,o,s){n.effectType===0&&this.emit("shieldChanged",n,o,s)}newPC(n,o,s){let i=he(this,ke,Wt).call(this,n.pcStruct.characterId,o);i?this.RemovePartyObject(n.pcStruct.characterId,s):this.RemoveLocalObject(n.pcStruct.playerId,s);for(let a of n.pcStruct.statusEffectDatas)this.RegisterStatusEffect(this.buildStatusEffect(a,i?n.pcStruct.characterId:n.pcStruct.playerId,a.sourceId,i?0:1,s))}buildStatusEffect(n,o,s,i,a){let m=n.value?n.value.readUInt32LE():0,c=n.value?n.value.readUInt32LE(8):0,l=m<c?m:c,k=0,h=0,v=0,G="Unknown",L=1,B=g(this,Re).skillBuff.get(n.statusEffectId);if(B){switch(G=B.name,B.category){case"debuff":k=1;break}switch(B.buffcategory){case"bracelet":h=1;break;case"etc":h=2;break;case"battleitem":h=3;break}switch(B.iconshowtype){case"all":v=1;break}switch(B.type){case"shield":L=0;break}}return{instanceId:n.effectInstanceId,sourceId:s,statusEffectId:n.statusEffectId,targetId:o,type:i,dbTarget:B?.target??"none",value:l,buffCategory:h,category:k,showType:v,expirationDelay:n.totalTime,expirationTimer:void 0,timestamp:n.endTick,expireAt:void 0,occurTime:n.occurTime,name:G,pktTime:a,effectType:L,stackCount:n.stackCount}}getStatusEffects(n,o,s,i){let a=[],m=[],c=he(this,we,fn).call(this,n,s),l=this.GetStatusEffects(c?n.characterId:n.entityId,c?0:1,i,void 0);for(let k of l)m.push([k.statusEffectId,k.sourceId,k.stackCount]);if(o){let k=he(this,we,fn).call(this,o,s),h=g(this,Y).isEntityInParty(n.entityId),v=h?g(this,Y).getPartyIdFromEntityId(n.entityId):void 0,G=h&&v?this.GetStatusEffectsFromParty(k?o.characterId:o.entityId,k?0:1,v,i):this.GetStatusEffects(k?o.characterId:o.entityId,k?0:1,i,n.entityId);for(let L of G)L.type===1&&L.category===1&&L.sourceId!==n.entityId&&L.dbTarget==="self"||a.push([L.statusEffectId,L.sourceId,L.stackCount])}return[m,a]}},ge=cn;Y=new WeakMap,Re=new WeakMap,U=new WeakMap,we=new WeakSet,fn=function(n,o){if(n.entityType!==1)return!1;let s=n;return he(this,ke,Wt).call(this,s.characterId,o)},ke=new WeakSet,Wt=function(n,o){let s=g(this,Y).isCharacterInParty(o),i=g(this,Y).isCharacterInParty(n);if(s){if(!i||n===o)return!1;let a=g(this,Y).getPartyIdFromCharacterId(o),m=g(this,Y).getPartyIdFromCharacterId(n);return a===m}return!1},$(ge,"TIMEOUT_DELAY_MS",1e3);var Vt=class{#e;#o;#i;#a;entities=new Map;localPlayer;constructor(e,n,o,s){this.#e=e,this.#o=n,this.#i=o,this.#a=s,this.localPlayer={entityId:0n,entityType:1,name:"You",class:0,gearLevel:0,characterId:0n,stance:0,stats:new Map,skills:new Map,items:{}}}processNewPC(e){let n=e.parsed;if(!n)return;let o={entityId:n.pcStruct.playerId,entityType:1,name:n.pcStruct.name,class:n.pcStruct.classId,gearLevel:n.pcStruct.maxItemLevel,characterId:n.pcStruct.characterId,stance:0,stats:this.#a.getStatPairMap(n.pcStruct.statPair),skills:new Map,items:{}};this.entities.set(o.entityId,o);let s=this.#e.getEntityId(o.characterId);s&&this.#o.changeEntityId(s,n.pcStruct.playerId),this.#e.addMapping(o.characterId,o.entityId),this.#o.completeEntry(o.characterId,o.entityId),this.#i.newPC(n,this.localPlayer.characterId,e.time),o.itemSet=this.getPlayerSetOptions(n.pcStruct.equipItemDataList);let i=[];n.pcStruct.equipItemDataList.forEach(m=>{m.id!==void 0&&m.slot!==void 0&&i.push({id:m.id,slot:m.slot})}),o.items.equipList=i;let a=[];return n.pcStruct.equipLifeToolDataList.forEach(m=>{m.id!==void 0&&m.slot!==void 0&&a.push({id:m.id,slot:m.slot})}),o.items.lifeToolList=a,o}processInitEnv(e){let n=e.parsed;if(!n)return;this.localPlayer.entityId!==0n&&this.#o.changeEntityId(this.localPlayer.entityId,n.playerId),this.entities.clear();let o={entityId:n.playerId,entityType:1,name:this.localPlayer.name,class:this.localPlayer.class,gearLevel:this.localPlayer.gearLevel,characterId:this.localPlayer.characterId,stance:this.localPlayer.stance,stats:this.localPlayer.stats,skills:this.localPlayer.skills,items:this.localPlayer.items};this.localPlayer=o,this.entities.set(o.entityId,o),this.#e.clear(),this.#i.Clear(e.time),o.characterId!==0n&&this.#e.addMapping(o.characterId,o.entityId),this.localPlayer&&this.localPlayer.characterId&&this.localPlayer.characterId>0n&&this.#o.completeEntry(this.localPlayer.characterId,n.playerId)}processInitPC(e){let n=e.parsed;if(!n)return;this.entities.clear();let o={entityId:n.playerId,entityType:1,name:n.name,class:n.classId,gearLevel:n.gearLevel,characterId:n.characterId,stance:0,stats:this.#a.getStatPairMap(n.statPair),skills:new Map,items:n.characterId===this.localPlayer.characterId?this.localPlayer.items:{}};this.localPlayer=o,this.entities.set(o.entityId,o),this.#e.addMapping(o.characterId,o.entityId),this.#o.setOwnName(n.name),this.#o.completeEntry(o.characterId,n.playerId),this.#i.RemoveLocalObject(n.playerId,e.time);for(let s of n.statusEffectDatas){let i=this.getSourceEntity(s.sourceId);this.#i.RegisterStatusEffect(this.#i.buildStatusEffect(s,n.playerId,i.entityId,1,e.time))}return o}processNewNpc(e){let n=e.parsed;if(!n)return;let o=!1,s=this.#a.npc.get(n.npcStruct.typeId);s&&[6,7,9,10].includes(ln[s.grade])&&(o=!0);let i={entityId:n.npcStruct.objectId,entityType:2,name:s?.name??n.npcStruct.objectId.toString(16),typeId:n.npcStruct.typeId,isBoss:o,grade:s?.grade??"none",pushimmune:s?.pushimmune??!1,stats:this.#a.getStatPairMap(n.npcStruct.statPair),level:n.npcStruct.level,balanceLevel:n.npcStruct.balanceLevel??n.npcStruct.level},a=this.#a.getNpcEsther(n.npcStruct.typeId);a!==void 0&&(i.entityType=4,i.name=a.name,i.icon=a.icon),this.entities.set(i.entityId,i),this.#i.RemoveLocalObject(n.npcStruct.objectId,e.time);for(let m of n.npcStruct.statusEffectDatas){let c=this.getSourceEntity(m.sourceId);this.#i.RegisterStatusEffect(this.#i.buildStatusEffect(m,n.npcStruct.objectId,c.entityId,1,e.time))}return i}processNewNpcSummon(e){let n=e.parsed;if(!n)return;let o=!1,s=this.#a.npc.get(n.npcData.typeId);s&&["boss","raid","epic_raid","commander"].includes(s.grade)&&(o=!0);let i={entityId:n.npcData.objectId,entityType:3,name:s?.name??n.npcData.objectId.toString(16),ownerId:n.ownerId,typeId:n.npcData.typeId,isBoss:o,grade:s?.grade??"none",pushimmune:s?.pushimmune??!1,stats:this.#a.getStatPairMap(n.npcData.statPair),level:n.npcData.level,balanceLevel:n.npcData.balanceLevel??n.npcData.level};this.#i.RemoveLocalObject(n.npcData.objectId,e.time);for(let a of n.npcData.statusEffectDatas){let m=this.getSourceEntity(a.sourceId);this.#i.RegisterStatusEffect(this.#i.buildStatusEffect(a,n.npcData.objectId,m.entityId,1,e.time))}return this.entities.set(i.entityId,i),i}getPlayerSetOptions(e){let n=new Map;e.forEach(s=>{if(s.id&&s.slot&&s.slot>=1&&s.slot<=6){let i=this.#a.itemSet.items.get(s.id);if(i){let a=n.get(i.setname);a||(a=new Map,n.set(i.setname,a)),a.set(i.level,(a.get(i.level)??0)+1)}}});let o=[];return n.forEach((s,i)=>{let a=this.#a.itemSet.seteffects.get(i);if(!a)return;let m=0,c=0;for(let[l,k]of[...s.entries()].sort((h,v)=>v[0]-h[0])){let h=a.get(l);if(!h)return;for(let[v,G]of[...h.entries()])v>m&&k+c>=v&&(o.push(...G.options),m=Math.max(m,v));c=k}}),o}getSourceEntity(e){let n=this.entities.get(e);if((n?.entityType===5||n?.entityType===3)&&(e=n.ownerId),n=this.entities.get(e),n)return n;let o={entityId:e,entityType:2,name:e.toString(16),stats:new Map};return this.entities.set(e,o),o}guessIsPlayer(e,n){let o=this.#a.getSkillClassId(n);if(o!==0){let s;if(e.entityType===1){let i=e;if(i.class===o)return i;s={entityId:i.entityId,entityType:1,name:i.name,class:o,gearLevel:i.gearLevel,characterId:i.characterId,stance:i.stance,stats:i.stats,skills:new Map,items:{}}}else s={entityId:e.entityId,entityType:1,name:e.name,class:o,gearLevel:0,characterId:0n,stance:0,stats:new Map,skills:new Map,items:{}};return this.entities.set(e.entityId,s),s}return e}getOrCreateEntity(e){let n=this.entities.get(e);return n||(n={entityId:e,entityType:0,name:e.toString(16),stats:new Map},this.entities.set(e,n)),n}getEntityByName(e){return[...this.entities.values()].find(n=>n.name===e)}};var Iu=require("tiny-typed-emitter");var vu=require("crypto");var Tu=um(require("axios"));var f=class{b;o;constructor(e){this.b=e,this.o=0}skip(e=0){this.o+=e}bool(){return this.u8()===1}u8(){return this.b.readUint8(this.o++)}i8(){return this.b.readInt8(this.o++)}u16(){let e=this.b.readUint16LE(this.o);return this.o+=2,e}i16(){let e=this.b.readInt16LE(this.o);return this.o+=2,e}u32(){let e=this.b.readUint32LE(this.o);return this.o+=4,e}i32(){let e=this.b.readInt32LE(this.o);return this.o+=4,e}f32(){let e=this.b.readFloatLE(this.o);return this.o+=4,e}u64(){let e=this.b.readBigUint64LE(this.o);return this.o+=8,e}i64(){let e=this.b.readBigInt64LE(this.o);return this.o+=8,e}string(e){let n=this.u16();if(n<=e){n=n*2;let o=this.b.toString("utf16le",this.o,this.o+n);return this.o+=n,o}return""}bytes(e=0,n,o){if(n&&e>n)return Buffer.alloc(0);o&&(e=e*o);let s=Buffer.from(this.b.subarray(this.o,this.o+e));return this.o+=e,s}array(e,n,o){return o&&e>o?[]:new Array(e).fill(void 0).map(n)}},Zt=class{b;o;constructor(e=65535){this.b=Buffer.allocUnsafe(e),this.o=0}get value(){return this.b.subarray(0,this.o)}skip(e=0){this.o+=e}bool(e=!1){return this.u8(e?1:0),e}u8(e=0){this.b.writeUInt8(e,this.o++)}i8(e=0){this.b.writeInt8(e,this.o++)}u16(e=0){this.o=this.b.writeUInt16LE(e,this.o)}i16(e=0){this.o=this.b.writeInt16LE(e,this.o)}u32(e=0){this.o=this.b.writeUInt32LE(e,this.o)}i32(e=0){this.o=this.b.writeInt32LE(e,this.o)}f32(e=0){this.o=this.b.writeFloatLE(e,this.o)}u64(e=0n){this.o=this.b.writeBigUInt64LE(BigInt(e),this.o)}i64(e=0n){this.o=this.b.writeBigInt64LE(BigInt(e),this.o)}string(e="",n=0){this.u16(e.length),e.length<=n&&(this.o+=this.b.write(e,this.o,"utf16le"))}bytes(e=Buffer.alloc(0),n={}){if(n.maxLen){let o=n.multiplier??1;if(e.length%o)throw new Error(`Error writing bytes, chunkSize should be a multiple of intut value size, got ${e.length}%${o}`);let s=e.length/o;if(s>n.maxLen)throw new Error(`Error writing bytes, input value size exceeded maxLen, got ${s} > ${n.maxLen}`);if(!n.lenType)throw new Error(`Error writing bytes, invalid lenType when writing chunks, got ${n.lenType}`);this[n.lenType](s)}else if(n.length&&e.length!==n.length)throw new Error(`Error writing bytes, input value size doesn't match opts.length, ${e.length} !== ${n.lenType}`);this.o+=e.copy(this.b,this.o)}array(e=[],n,o){if(e===void 0||e.length>n.maxLen){this[n.lenType](0);return}this[n.lenType](e.length),e.forEach(o)}};var oe=class{time;#e;#o;#i;#a;constructor(...e){if(e.length===5){let[n,o,s,i,a]=e;this.#o=n,this.time=s,this.#e=o,this.#i=i,this.#a=a}else if(e.length===3){let[n,o,s]=e;this.#o=Buffer.alloc(0),this.time=new Date,this.#e=o,this.#i=()=>n,this.#a=s}else throw new Error("[meter-core/logger/parser] - LogEvent<T>: Invalid constructor arguments")}#n;get parsed(){if(!this.#n)try{this.#n=this.#i(new f(this.#o))}catch(e){console.error(`[meter-core/logger/parser] - parsed - ${e}`);return}return this.#n}#t;get serialized(){if(!this.#t)try{if(!this.parsed)return;let e=new Zt;e.skip(Gr),this.#a(e,this.parsed);let n=e.value;n.writeUint16LE(n.length,zr),n.writeUint16LE(this.#e,hn),n.writeUintLE(+new Date,Hr,Sn),this.#t=e.value}catch(e){console.error(`[meter-core/logger/parser] - serialized - ${e}`);return}return this.#t}},dn=6,Zr=2,zr=0,pn=2,hn=zr+Zr,Sn=6,Hr=hn+pn,Gr=Zr+pn+Sn;function kn(t,e){let n={};return n.cooldown1=t.f32(),n.cooldown2=t.f32(),n.skillId=t.u32(),n}function bn(t,e){t.f32(e.cooldown1),t.f32(e.cooldown2),t.u32(e.skillId)}var Pn="SkillCooldownNotify";function be(t,e){let n={};return n.points=t.u16(),n.id=t.u32(),n.level=t.u8(),n}function Pe(t,e){t.u16(e.points),t.u32(e.id),t.u8(e.level)}function Tn(t,e){let n={};return n.abilityDataList=t.array(t.u16(),()=>be(t,e),100),n}function In(t,e){t.array(e.abilityDataList,{maxLen:100,lenType:"u16"},n=>{Pe(t,n)})}var En="AbilityChangeNotify";function Yr(t,e){let n={};return n.featureType=t.u16(),n.level=t.u32(),n}function $r(t,e){t.u16(e.featureType),t.u32(e.level)}function xn(t,e){let n={};return n.activeAbilityList=t.array(t.u16(),()=>Yr(t,e),60),n.objectId=t.u64(),n}function Nn(t,e){t.array(e.activeAbilityList,{maxLen:60,lenType:"u16"},n=>{$r(t,n)}),t.u64(e.objectId)}var Dn="ActiveAbilityNotify";function gn(t,e){let n={};return n.objectId=t.u64(),n.addonSkillFeatureList=t.array(t.u16(),()=>{let o={};return o.addonSkillFeatureIdList=t.array(t.u16(),()=>t.u32(),5),o.skillId=t.u32(),o},200),n}function Rn(t,e){t.u64(e.objectId),t.array(e.addonSkillFeatureList,{maxLen:200,lenType:"u16"},n=>{t.array(n.addonSkillFeatureIdList,{maxLen:5,lenType:"u16"},o=>{t.u32(o)}),t.u32(n.skillId)})}var wn="AddonSkillFeatureChangeNotify";function Ln(t,e){let n={};return n.paralyzationMaxPoint=t.u32(),n.type=t.u8(),n.objectId=t.u64(),n.paralyzationPoint=t.u32(),n}function Kn(t,e){t.u32(e.paralyzationMaxPoint),t.u8(e.type),t.u64(e.objectId),t.u32(e.paralyzationPoint)}var An="BlockSkillStateNotify";function Bn(t,e){let n={};return n.sourceId=t.u64(),n.targetId=t.u64(),n.type=t.u32(),n}function Cn(t,e){t.u64(e.sourceId),t.u64(e.targetId),t.u32(e.type)}var Mn="CounterAttackNotify";function jn(t,e){let n={};return n.sourceId=t.u64(),n.targetId=t.u64(),e>=4?(n.effectId=t.u32(),n.directionYaw=t.u16(),n.deathType=t.u8(),n.durabilityDecrement=t.u8(),n.abnormalStatusType=t.u8(),n.damageAttr=t.u8(),n.unk0_m=t.u64(),n.unk2_m=t.u32()):(n.effectId=0,n.directionYaw=0,n.deathType=0,n.durabilityDecrement=0,n.abnormalStatusType=0,n.damageAttr=0,n.unk0_m=0n,n.unk2_m=0),n}function On(t,e){t.u64(e.sourceId),t.u64(e.targetId),t.u32(e.effectId),t.u16(e.directionYaw),t.u8(e.deathType??0),t.u8(e.durabilityDecrement),t.u8(e.abnormalStatusType??0),t.u8(e.damageAttr??0),t.u64(e.unk0_m),t.u32(e.unk2_m)}var Fn="DeathNotify";function qn(t,e){let n={};return n.abilityDataList=t.array(t.u16(),()=>be(t,e),100),n}function Wn(t,e){t.array(e.abilityDataList,{maxLen:100,lenType:"u16"},n=>{Pe(t,n)})}var Un="InitAbility";function Vn(t,e){let n={};return n.playerId=t.u64(),n}function Zn(t,e){t.u64(e.playerId)}var zn="InitEnv";var fm=[0,31,28,31,30,31,30,31,31,30,31,30,31];function cm(t){return!(t%4||!(t%100)&&t%400)}function dm(t,e,n){if(t>99){if(t<1752||t==1752&&(e<9||e==9&&n<<14))return!1}else t+=1900;return n>0&&e<=12&&(n<=fm[e]||n==29&&e==2&&cm(t))}function Hn(t){let e=Number(t&0xffffffffn),n=Number(t>>32n&0xffffffffn),o=e&4095,s=(e&65535)>>12,i=e>>16&31;dm(o,s,i)||(o=s=i=0);let a=e>>21&31,m=e>>26&63,c=n&63,l=n>>6&16383;return a<24&&m<60&&c<60&&l<1e3||(a=24,m=c=l=0),new Date(Date.UTC(o<=99?o+1900:o,s-1,i,a,m,c,l))}function Jr(t){let e=0n;return e|=BigInt(t.getUTCMilliseconds())<<38n,e|=BigInt(t.getUTCSeconds())<<32n,e|=BigInt(t.getUTCMinutes())<<26n,e|=BigInt(t.getUTCHours())<<21n,e|=BigInt(t.getUTCDate())<<16n,e|=BigInt(t.getUTCMonth()+1)<<12n,e|=BigInt(t.getUTCFullYear()<2e3?t.getUTCFullYear()-1900:t.getUTCFullYear()),e}function W(t,e=0){let n=t.u16();return(n&4095)<2079?(t.o-=2,Hn(t.i64())):Hn(BigInt(n)&0xfffn|0x11000n)}function re(t,e=Hn(0x1181fn)){e.getUTCFullYear()>=2079?t.u16(Number(Jr(e)&0xffffn)):t.i64(Jr(e))}function V(t,e){let n={};return n.skillLevel=t.u8(),n.occurTime=W(t,e),n.statusEffectId=t.u32(),n.sourceId=t.u64(),n.totalTime=t.f32(),n.endTick=t.u64(),t.bool()&&(n.value=t.bytes(16)),n.effectInstanceId=t.u32(),e>=1?n.stackCount=t.u8():n.stackCount=1,n}function Z(t,e){t.u8(e.skillLevel),re(t,e.occurTime),t.u32(e.statusEffectId),t.u64(e.sourceId),t.f32(e.totalTime),t.u64(e.endTick),t.bool(e.value!==void 0)&&t.bytes(e.value,{length:16}),t.u32(e.effectInstanceId),t.u8(e.stackCount)}function pm(t){if(t.length===0)return 0n;if(t.length>8)throw new Error("Value is too large");let e=Buffer.alloc(8);return t.copy(e),e.readBigInt64LE()}function T(t,e=0){let n=t.u8(),o=t.bytes(n>>1&7),s=pm(o)<<4n|BigInt(n>>4);return n&1?-s:s}function M(t,e=0n){let n=Buffer.alloc(8),o=e<0n;n.writeBigInt64LE((o?-e:e)>>4n);let s=0;for(let[i,a]of n.entries())a!=0&&(s=i+1);if(s>7)throw new Error("Value is too large");t.u8(Number((o?-e:e)&0xfn)<<4|(s&7)<<1|(o?1:0)),t.bytes(n.subarray(0,s),{length:s})}function Gn(t,e){let n={};return n.statPair=t.array(t.u16(),()=>{let o={};return o.StatType=t.u8(),o.Value=T(t,e),o},152),n.name=t.string(20),n.level=t.u16(),n.statusEffectDatas=t.array(t.u16(),()=>V(t,e),80),n.characterId=t.u64(),n.gearLevel=t.f32(),n.playerId=t.u64(),n.classId=t.u16(),n}function Yn(t,e){t.array(e.statPair,{maxLen:152,lenType:"u16"},n=>{t.u8(n.statType),M(t,n.value)}),t.string(e.name,20),t.u16(e.level),t.array(e.statusEffectDatas,{maxLen:80,lenType:"u16"},n=>{Z(t,n)}),t.u64(e.characterId),t.f32(e.gearLevel),t.u64(e.playerId),t.u16(e.classId)}var $n="InitPC";function Jn(t,e){let n={};return n.statPair=t.array(t.u16(),()=>{let o={};return o.statType=t.u8(),o.value=T(t,e),o},152),n.statusEffectDatas=t.array(t.u16(),()=>V(t,e),80),n.addonSkillFeatureList=t.array(t.u16(),()=>{let o={};return o.addonSkillFeatureIdList=t.array(t.u16(),()=>t.u32(),5),o.skillId=t.u32(),o},200),n.abilityDataList=t.array(t.u16(),()=>be(t,e),100),n}function Qn(t,e){t.array(e.statPair,{maxLen:152,lenType:"u16"},n=>{t.u8(n.statType),M(t,n.value)}),t.array(e.statusEffectDatas,{maxLen:80,lenType:"u16"},n=>{Z(t,n)}),t.array(e.addonSkillFeatureList,{maxLen:200,lenType:"u16"},n=>{t.array(n.addonSkillFeatureIdList,{maxLen:5,lenType:"u16"},o=>{t.u32(o)}),t.u32(n.skillId)}),t.array(e.abilityDataList,{maxLen:100,lenType:"u16"},n=>{Pe(t,n)})}var Xn="InitLocal";function yn(t,e){let n={};return n.account_CharacterId1=t.u64(),n.serverAddr=t.string(256),n.account_CharacterId2=t.u64(),n}function Le(t,e){t.u64(e.account_CharacterId1),t.string(e.serverAddr,256),t.u64(e.account_CharacterId2)}var eo="MigrationExecute";function to(t){return t>>20===1?-((~t>>>0)+1&2097151):t}function N(t,e=0){let n=t.u64();return{x:to(Number(n&0x1fffffn)),y:to(Number(n>>21n&0x1fffffn)),z:to(Number(n>>42n&0x1fffffn))}}function F(t,e={x:0,y:0,z:0}){t.u64(BigInt(Math.round(e.x??0)>>>0&2097151)|BigInt(Math.round(e.y??0)>>>0&2097151)<<21n|BigInt(Math.round(e.z??0)>>>0&2097151)<<42n)}function A(t,e=0){return t.u16()*(2*Math.PI)/65536}function X(t,e=0){t.u16(Math.round(e*65536/(2*Math.PI))%65536)}function zt(t,e){let n={};return n.spawnIndex=t.u32(),n.objectId=t.u64(),t.bool()&&(n.transitIndex=t.u32()),n.position=N(t,e),n.statusEffectDatas=t.array(t.u16(),()=>V(t,e),80),n.directionYaw=A(t,e),n.statPair=t.array(t.u16(),()=>{let o={};return o.statType=t.u8(),o.value=T(t,e),o},152),n.typeId=t.u32(),e>=1?(n.level=t.u16(),t.bool()&&(n.balanceLevel=t.u16())):n.level=0,n}function Ht(t,e){t.u32(e.spawnIndex),t.u64(e.objectId),t.bool(e.transitIndex!==void 0)&&t.u32(e.transitIndex),F(t,e.position),t.array(e.statusEffectDatas,{maxLen:80,lenType:"u16"},n=>{Z(t,n)}),X(t,e.directionYaw),t.array(e.statPair,{maxLen:152,lenType:"u16"},n=>{t.u8(n.statType),M(t,n.value)}),t.u32(e.typeId),t.u16(e.level),t.bool(e.balanceLevel!==void 0)&&t.u16(e.balanceLevel)}function no(t,e){let n={};return n.npcStruct=zt(t,e),n}function oo(t,e){Ht(t,e.npcStruct)}var ao="NewNpc";function so(t,e){let n={};return n.publishReason=t.u8(),n.ownerId=t.u64(),n.npcData=zt(t,e),n}function io(t,e){t.u8(e.publishReason),t.u64(e.ownerId),Ht(t,e.npcData)}var ro="NewNpcSummon";function _e(t,e){let n={};return n.slot=t.u16(),n.level=t.u16(),n.itemTint=t.bytes(t.u16(),3,14),n.expireTime=W(t),n.id=t.u32(),n}function le(t,e){t.u16(e.slot),t.u16(e.level),t.bytes(e.itemTint,{maxLen:3,lenType:"u16",multiplier:14}),re(t,e.expireTime),t.u32(e.id)}function Xr(t,e){let n={};return n.maxItemLevel=t.f32(),n.statPair=t.array(t.u16(),()=>{let o={};return o.statType=t.u8(),o.value=T(t,e),o},152),n.name=t.string(20),n.heading=A(t,e),n.characterId=t.u64(),n.playerId=t.u64(),n.addonSkillFeatureList=t.array(t.u16(),()=>{let o={};return o.addonSkillFeatureIdList=t.array(t.u16(),()=>t.u32(),5),o.skillId=t.u32(),o},200),n.classId=t.u16(),n.level=t.u16(),n.statusEffectDatas=t.array(t.u16(),()=>V(t,e),80),e>=1?(n.avgItemLevel=t.f32(),n.position=N(t),n.equipItemDataList=t.array(t.u16(),()=>_e(t,e),32),n.equipLifeToolDataList=t.array(t.u16(),()=>_e(t,e),9),n.guildName=t.string(20),e>=2?n.guildId=t.u64():n.guildId=BigInt(t.u32())):(n.avgItemLevel=n.maxItemLevel,n.position={x:0,y:0,z:0},n.equipItemDataList=[],n.equipLifeToolDataList=[],n.guildName="",n.guildId=0n),n}function yr(t,e){t.f32(e.maxItemLevel),t.array(e.statPair,{maxLen:152,lenType:"u16"},n=>{t.u8(n.statType),M(t,n.value)}),t.string(e.name,20),X(t,e.heading),t.u64(e.characterId),t.u64(e.playerId),t.array(e.addonSkillFeatureList,{maxLen:200,lenType:"u16"},n=>{t.array(n.addonSkillFeatureIdList,{maxLen:5,lenType:"u16"},o=>{t.u32(o)}),t.u32(n.skillId)}),t.u16(e.classId),t.u16(e.level),t.array(e.statusEffectDatas,{maxLen:80,lenType:"u16"},n=>{Z(t,n)}),t.f32(e.avgItemLevel),F(t,e.position),t.array(e.equipItemDataList,{maxLen:32,lenType:"u16"},n=>{le(t,n)}),t.array(e.equipLifeToolDataList,{maxLen:9,lenType:"u16"},n=>{le(t,n)}),t.string(e.guildName,20),t.u64(e.guildId)}function mo(t,e){let n={};return n.pcStruct=Xr(t,e),n}function _o(t,e){yr(t,e.pcStruct)}var lo="NewPC";function ve(t,e=0){return{first:t.u8(),second:t.u8(),third:t.u8()}}function Gt(t,e){t.u8(e.first),t.u8(e.second),t.u8(e.third)}function Te(t,e=0){return{first:t.u16(),second:t.u16(),third:t.u16()}}function Yt(t,e){t.u16(e.first),t.u16(e.second),t.u16(e.third)}function eu(t,e){let n={};return n.tripodIndex=ve(t,e),n.chainSkillEffect=t.u32(),n.skillEffect=t.u32(),n.skillId=t.u32(),n.targetObjectId=t.u64(),n.ownerId=t.u64(),n.skillLevel=t.u8(),n.projectileId=t.u64(),n.tripodLevel=Te(t,e),n}function tu(t,e){Gt(t,e.tripodIndex),t.u32(e.chainSkillEffect),t.u32(e.skillEffect),t.u32(e.skillId),t.u64(e.targetObjectId),t.u64(e.ownerId),t.u8(e.skillLevel),t.u64(e.projectileId),Yt(t,e.tripodLevel)}function po(t,e){let n={};return n.projectileInfo=eu(t,e),n}function ho(t,e){tu(t,e.projectileInfo)}var So="NewProjectile";function ko(t,e){let n={};return n.enable=t.bool(),n.paralyzationPoint=t.u32(),n.decreasePoint=t.u32(),n.paralyzationMaxPoint=t.u32(),n.noHitCheckTime=t.u32(),n.hitCheckTime=t.u32(),n.objectId=t.u64(),n}function bo(t,e){t.bool(e.enable),t.u32(e.paralyzationPoint),t.u32(e.decreasePoint),t.u32(e.paralyzationMaxPoint),t.u32(e.noHitCheckTime),t.u32(e.hitCheckTime),t.u64(e.objectId)}var Po="ParalyzationStateNotify";function nu(t,e){let n={};return n.maxHp=T(t,e),n.characterId=t.u64(),n.position=N(t,e),n.transitIndex=t.u32(),n.curHp=T(t,e),n.characterLevel=t.u16(),n.gearLevel=t.f32(),n.zoneId=t.u32(),n.partyMemberNumber=t.u8(),n.name=t.string(20),n.zoneInstId=t.u64(),n.worldId=t.u8(),n.classId=t.u16(),n.auths=t.u8(),n}function ou(t,e){M(t,e.maxHp),t.u64(e.characterId),F(t,e.position),t.u32(e.transitIndex),M(t,e.curHp),t.u16(e.characterLevel),t.f32(e.gearLevel),t.u32(e.zoneId),t.u8(e.partyMemberNumber),t.string(e.name,20),t.u64(e.zoneInstId),t.u8(e.worldId),t.u16(e.classId),t.u8(e.auths)}function vo(t,e){let n={};return n.raidInstanceId=t.u32(),n.lootGrade=t.u32(),n.partyType=t.u8(),n.partyInstanceId=t.u32(),n.partyLootType=t.u8(),n.memberDatas=t.array(t.u16(),()=>nu(t,e),40),n}function To(t,e){t.u32(e.raidInstanceId),t.u32(e.lootGrade),t.u8(e.partyType),t.u32(e.partyInstanceId),t.u8(e.partyLootType),t.array(e.memberDatas,{maxLen:40,lenType:"u16"},n=>{ou(t,n)})}var Io="PartyInfo";function Eo(t,e){let n={};return n.partyLeaveType=t.u8(),n.partyInstanceId=t.u32(),n.name=t.string(20),n}function xo(t,e){t.u8(e.partyLeaveType),t.u32(e.partyInstanceId),t.string(e.name,20)}var No="PartyLeaveResult";function Do(t,e){let n={};return n.objectId=t.u64(),n.passiveStatusEffectList=t.array(t.u16(),()=>t.u32(),10),n.unk0_m=t.u8(),n}function go(t,e){t.u64(e.objectId),t.array(e.passiveStatusEffectList,{maxLen:10,lenType:"u16"},n=>{t.u32(n)}),t.u8(e.unk0_m)}var Ro="PartyPassiveStatusEffectAddNotify";function wo(t,e){let n={};return n.objectId=t.u64(),n.passiveStatusEffectList=t.array(t.u16(),()=>t.u32(),10),n}function Lo(t,e){t.u64(e.objectId),t.array(e.passiveStatusEffectList,{maxLen:10,lenType:"u16"},n=>{t.u32(n)})}var Ko="PartyPassiveStatusEffectRemoveNotify";function Ao(t,e){let n={};return n.characterId=t.u64(),n.statusEffectDatas=t.array(t.u16(),()=>V(t,e),80),n.playerIdOnRefresh=t.u64(),n}function Bo(t,e){t.u64(e.characterId),t.array(e.statusEffectDatas,{maxLen:80,lenType:"u16"},n=>{Z(t,n)}),t.u64(e.playerIdOnRefresh)}var Co="PartyStatusEffectAddNotify";function Mo(t,e){let n={};return n.characterId=t.u64(),n.statusEffectIds=t.array(t.u16(),()=>t.u32(),80),n.reason=t.u8(),n}function jo(t,e){t.u64(e.characterId),t.array(e.statusEffectIds,{maxLen:80,lenType:"u16"},n=>{t.u32(n)}),t.u8(e.reason)}var Oo="PartyStatusEffectRemoveNotify";function Fo(t,e){let n={};return n.partyInstanceId=t.u32(),n.raidInstanceId=t.u32(),n.characterId=t.u64(),n}function qo(t,e){t.u32(e.partyInstanceId),t.u32(e.raidInstanceId),t.u64(e.characterId)}var Wo="PartyStatusEffectResultNotify";function Uo(t,e){let n={};return n.passiveStatusEffectList=t.array(t.u16(),()=>t.u32(),10),n}function Vo(t,e){t.array(e.passiveStatusEffectList,{maxLen:10,lenType:"u16"},n=>{t.u32(n)})}var Zo="PassiveStatusEffectAddNotify";function zo(t,e){let n={};return n.passiveStatusEffectList=t.array(t.u16(),()=>t.u32(),10),n}function Ho(t,e){t.array(e.passiveStatusEffectList,{maxLen:10,lenType:"u16"},n=>{t.u32(n)})}var Go="PassiveStatusEffectRemoveNotify";function Yo(t,e){let n={};return e>=4?n.typeId=t.u32():n.typeId=0,n}function $o(t,e){t.u32(e.typeId)}var Jo="RaidBossKillNotify";function Qo(t,e){let n={};return e>=3?n.raidResult=t.u8():n.raidResult=0,n}function Xo(t,e){t.u8(e.raidResult)}var yo="RaidResult";function au(t,e){let n={};return n.unpublishReason=t.u8(),n.objectId=t.u64(),n}function su(t,e){t.u8(e.unpublishReason),t.u64(e.objectId)}function ea(t,e){let n={};return n.unpublishedObjects=t.array(t.u16(),()=>au(t,e),200),n}function ta(t,e){t.array(e.unpublishedObjects,{maxLen:200,lenType:"u16"},n=>{su(t,n)})}var na="RemoveObject";function $t(t,e=0){let n={},o=t.u8();return o&1&&(n.moveTime=t.u32()),o&2&&(n.standUpTime=t.u32()),o&4&&(n.downTime=t.u32()),o&8&&(n.freezeTime=t.u32()),o&16&&(n.moveHeight=t.u32()),o&32&&(n.farmostDist=t.u32()),o&64&&(n.flag40=t.bytes(t.u16(),6)),n}function iu(t,e){let n=(e.moveTime===void 0?0:1)|(e.standUpTime===void 0?0:2)|(e.downTime===void 0?0:4)|(e.freezeTime===void 0?0:8)|(e.moveHeight===void 0?0:16)|(e.farmostDist===void 0?0:32)|(e.flag40===void 0?0:64);t.u8(n),n&1&&t.u32(e.moveTime),n&2&&t.u32(e.standUpTime),n&4&&t.u32(e.downTime),n&8&&t.u32(e.freezeTime),n&16&&t.u32(e.moveHeight),n&32&&t.u32(e.farmostDist),n&64&&t.bytes(e.flag40,{maxLen:6,lenType:"u16"})}function Jt(t,e){let n={};return n.modifier=t.u8(),n.targetId=t.u64(),n.damageType=t.u8(),t.bool()&&(n.damageAttr=t.u8()),n.curHp=T(t,e),n.unk3_m=t.u16(),n.maxHp=T(t,e),n.damage=T(t,e),n}function Qt(t,e){t.u8(e.modifier),t.u64(e.targetId),t.u8(e.damageType),t.bool(e.damageAttr!==void 0)&&t.u8(e.damageAttr),M(t,e.curHp),t.u16(e.unk3_m),M(t,e.maxHp),M(t,e.damage)}function mu(t,e){let n={};return n.skillMoveOptionData=$t(t,e),n.destination=N(t,e),n.position=N(t,e),n.skillDamageEvent=Jt(t,e),n}function _u(t,e){iu(t,e.skillMoveOptionData),F(t,e.destination),F(t,e.position),Qt(t,e.skillDamageEvent)}function oa(t,e){let n={};return n.skillId=t.u32(),n.skillDamageAbnormalMoveEvents=t.array(t.u16(),()=>mu(t,e),50),n.skillEffectId=t.u32(),n.sourceId=t.u64(),n}function aa(t,e){t.u32(e.skillId),t.array(e.skillDamageAbnormalMoveEvents,{maxLen:50,lenType:"u16"},n=>{_u(t,n)}),t.u32(e.skillEffectId),t.u64(e.sourceId)}var sa="SkillDamageAbnormalMoveNotify";function ia(t,e){let n={};return n.skillLevel=t.u8(),n.sourceId=t.u64(),n.skillId=t.u32(),n.skillDamageEvents=t.array(t.u16(),()=>Jt(t,e),50),n.skillEffectId=t.u32(),n}function ra(t,e){t.u8(e.skillLevel),t.u64(e.sourceId),t.u32(e.skillId),t.array(e.skillDamageEvents,{maxLen:50,lenType:"u16"},n=>{Qt(t,n)}),t.u32(e.skillEffectId??0)}var ua="SkillDamageNotify";function ma(t,e){let n={};return n.sourceId=t.u64(),n.skillId=t.u32(),n.stage=t.u8(),n}function _a(t,e){t.u64(e.sourceId),t.u32(e.skillId),t.u8(e.stage)}var la="SkillStageNotify";function Xt(t,e=0){let n={},o=t.u8();return o&1&&(n.layerIndex=t.u8()),o&2&&(n.startStageIndex=t.u8()),o&4&&(n.transitIndex=t.u32()),o&8&&(n.stageStartTime=t.u32()),o&16&&(n.farmostDistance=t.u32()),o&32&&(n.tripodIndex=ve(t)),o&64&&(n.tripodLevel=Te(t)),n}function lu(t,e){let n=(e.layerIndex===void 0?0:1)|(e.startStageIndex===void 0?0:2)|(e.transitIndex===void 0?0:4)|(e.stageStartTime===void 0?0:8)|(e.farmostDistance===void 0?0:16)|(e.tripodIndex===void 0?0:32)|(e.tripodLevel===void 0?0:64);t.u8(n),n&1&&t.u8(e.layerIndex),n&2&&t.u8(e.startStageIndex),n&4&&t.u32(e.transitIndex),n&8&&t.u32(e.stageStartTime),n&16&&t.u32(e.farmostDistance),n&32&&Gt(t,e.tripodIndex),n&64&&Yt(t,e.tripodLevel)}function fa(t,e){let n={};return n.sourceId=t.u64(),n.curDirectionYaw=A(t,e),n.newDirectionYaw=A(t,e),n.aimTargetPosition=N(t,e),t.bool()&&(n.pitchRotation=A(t,e)),t.bool()&&(n.aiStateId=t.u32()),n.curPosition=N(t,e),t.bool()&&(n.unk1_m=t.u32()),n.skillLevel=t.u8(),n.newPosition=N(t,e),n.skillId=t.u32(),n.skillOptionData=Xt(t,e),n}function ca(t,e){t.u64(e.sourceId),X(t,e.curDirectionYaw),X(t,e.newDirectionYaw),F(t,e.aimTargetPosition),t.bool(e.pitchRotation!==void 0)&&X(t,e.pitchRotation),t.bool(e.aiStateId!==void 0)&&t.u32(e.aiStateId),F(t,e.curPosition),t.bool(e.unk1_m!==void 0)&&t.u32(e.unk1_m),t.u8(e.skillLevel),F(t,e.newPosition),t.u32(e.skillId),lu(t,e.skillOptionData)}var da="SkillStartNotify";function pa(t,e){let n={};return n.statusEffectData=V(t,e),n.objectId=t.u64(),n.new=t.bool(),n}function ha(t,e){Z(t,e.statusEffectData),t.u64(e.objectId),t.bool(e.new)}var Sa="StatusEffectAddNotify";function ka(t,e){let n={};return n.statusEffectIds=t.array(t.u16(),()=>t.u32(),80),n.objectId=t.u64(),n.reason=t.u8(),n}function ba(t,e){t.array(e.statusEffectIds,{maxLen:80,lenType:"u16"},n=>{t.u32(n)}),t.u64(e.objectId),t.u8(e.reason)}var Pa="StatusEffectRemoveNotify";function va(t,e){let n={};return n.effectInstanceId=t.u32(),n.targetId=t.u64(),n.expirationTick=t.u64(),n}function Ta(t,e){t.u32(e.effectInstanceId),t.u64(e.targetId),t.u64(e.expirationTick)}var Ia="StatusEffectDurationNotify";function Ea(t,e){let n={};return n.objectId=t.u64(),n.effectInstanceId=t.u32(),n.characterId=t.u64(),n.value=t.u32(),n}function xa(t,e){t.u64(e.objectId),t.u32(e.effectInstanceId),t.u64(e.characterId),t.u32(e.value)}var Na="StatusEffectSyncDataNotify";function Da(t,e){let n={};return n.step=t.u32(),n.unk2_m=t.bool(),n.triggerId=t.u32(),n}function ga(t,e){t.u32(e.step),t.bool(e.unk2_m),t.u32(e.triggerId)}var Ra="TriggerBossBattleStatus";function wa(t,e){let n={};return n.packetResultCode=t.u32(),n.triggerId=t.u32(),n.unk0_m=t.u32(),n.involvedPCs=t.array(t.u16(),()=>t.u64(),40),n}function La(t,e){t.u32(e.packetResultCode),t.u32(e.triggerId),t.u32(e.unk0_m),t.array(e.involvedPCs,{maxLen:40,lenType:"u16"},n=>{t.u64(n)})}var Ka="TriggerFinishNotify";function Aa(t,e){let n={};return n.triggerId=t.u32(),n.triggerSignalType=t.u32(),n.sourceId=t.u64(),n.involvedPCs=t.array(t.u16(),()=>t.u64(),40),n}function Ba(t,e){t.u32(e.triggerId),t.u32(e.triggerSignalType),t.u64(e.sourceId),t.array(e.involvedPCs,{maxLen:40,lenType:"u16"},n=>{t.u64(n)})}var Ca="TriggerStartNotify";function Ma(t,e){let n={};return n.maxHp=T(t,e),n.characterId=t.u64(),n.unk0_m=t.u32(),n.statusEffectDatas=t.array(t.u16(),()=>V(t,e),80),n.position=t.u64(),n.curHp=T(t,e),n}function ja(t,e){M(t,e.maxHp),t.u64(e.characterId),t.u32(e.unk0_m),t.array(e.statusEffectDatas,{maxLen:80,lenType:"u16"},n=>{Z(t,n)}),t.u64(e.position),M(t,e.curHp)}var Oa="TroopMemberUpdateMinNotify";function Fa(t,e){let n={};return n.identityGauge1=t.u32(),n.identityGauge2=t.u32(),n.identityGauge3=t.u32(),n.playerId=t.u64(),n}function qa(t,e){t.u32(e.identityGauge1),t.u32(e.identityGauge2),t.u32(e.identityGauge3),t.u64(e.playerId)}var Wa="IdentityGaugeChangeNotify";function Ua(t,e){let n={};return n.objectId=t.u64(),n}function Va(t,e){t.u64(e.objectId)}var Za="ZoneObjectUnpublishNotify";function cu(t,e){let n={};return n.stackCount=t.u8(),n.target=t.u8(),n.id=t.u32(),n}function du(t,e){t.u8(e.stackCount),t.u8(e.target),t.u32(e.id)}function za(t,e){let n={};return n.zoneStatusEffectDataList=t.array(t.u16(),()=>cu(t,e),4),n}function Ha(t,e){t.array(e.zoneStatusEffectDataList,{maxLen:4,lenType:"u16"},n=>{du(t,n)})}var Ga="ZoneStatusEffectAddNotify";function Ya(t,e){let n={};return n.statusEffectId=t.u32(),n}function $a(t,e){t.u32(e.statusEffectId)}var Ja="ZoneStatusEffectRemoveNotify";function Qa(t,e){let n={};return n.skillLevel=t.u8(),n.caster=t.u64(),n.skillId=t.u32(),n}function Xa(t,e){t.u8(e.skillLevel),t.u64(e.caster),t.u32(e.skillId)}var ya="SkillCastNotify";function es(t,e){let n={};return n.objectId=t.u64(),n.stance=t.u8(),n}function ts(t,e){t.u64(e.objectId),t.u8(e.stance)}var ns="IdentityStanceChangeNotify";function os(t,e){let n={};return n.objectId=t.u64(),n.equipItemDataList=t.array(t.u16(),()=>_e(t,e),32),n}function as(t,e){t.u64(e.objectId),t.array(e.equipItemDataList,{maxLen:32,lenType:"u16"},n=>{le(t,n)})}var ss="EquipChangeNotify";function is(t,e){let n={};return n.objectId=t.u64(),n.equipLifeToolDataList=t.array(t.u16(),()=>_e(t,e),9),n}function rs(t,e){t.u64(e.objectId),t.array(e.equipLifeToolDataList,{maxLen:9,lenType:"u16"},n=>{le(t,n)})}var us="EquipLifeToolChangeNotify";function pu(t,e){let n={};return t.bool()&&(n.serialNumber=t.u64(),n.id=t.u32(),n.level=t.u16(),n.slot=t.u16(),n.durability=t.u32(),n.unk1_6_m=t.u32(),n.flag=t.u32(),n.expireTime=W(t),n.lockUpdateTime=W(t)),n}function hu(t,e){t.bool(e.slot!==void 0)&&(t.u64(e.serialNumber),t.u32(e.id),t.u16(e.level),t.u16(e.slot),t.u32(e.durability),t.u32(e.unk1_6_m),t.u32(e.flag),re(t,e.expireTime),re(t,e.lockUpdateTime))}function ms(t,e){let n={};return n.itemDataList=t.array(t.u16(),()=>pu(t,e),80),n.storageType=t.u8(),n}function _s(t,e){t.array([1,20].includes(e.storageType)?e.itemDataList:[],{maxLen:80,lenType:"u16"},n=>{hu(t,n)}),t.u8(e.storageType)}var ls="InitItem";function Su(t,e){let n={};return n.npcId=t.u32(),n.isDead=t.bool(),n}function ku(t,e){t.u32(e.npcId),t.bool(e.isDead)}function fs(t,e){let n={};return n.raidResult=t.u8(),n.raidId=t.u32(),n.totalTime=t.u64(),n.bossKillDataList=t.array(t.u16(),()=>Su(t,e),3),n.endTick=t.u64(),n.startTick=t.u64(),n}function cs(t,e){t.u8(e.raidResult),t.u32(e.raidId),t.u64(e.totalTime),t.array(e.bossKillDataList,{maxLen:3,lenType:"u16"},n=>{ku(t,n)}),t.u64(e.endTick),t.u64(e.startTick)}var ds="RaidBegin";function ps(t,e){let n={};return n.zoneInstId=t.u64(),n.zoneId=t.u32(),n.loadComplete=t.bool(),n.completeMembers=t.array(t.u16(),()=>t.u64(),40),n.totalMembers=t.array(t.u16(),()=>t.u64(),40),n.firstPCEnterTick=t.u64(),n.zoneLevel=t.u8(),n}function hs(t,e){t.u64(e.zoneInstId),t.u32(e.zoneId),t.bool(e.loadComplete),t.array(e.completeMembers,{maxLen:40,lenType:"u16"},n=>{t.u64(n)}),t.array(e.totalMembers,{maxLen:40,lenType:"u16"},n=>{t.u64(n)}),t.u64(e.firstPCEnterTick),t.u8(e.zoneLevel)}var Ss="ZoneMemberLoadStatusNotify";function bu(t,e){let n={};return n.position=N(t),n.objectId=t.u64(),n.ownerId=t.u64(),n.skillId=t.u32(),n.skillEffect=t.u32(),n}function Pu(t,e){F(t,e.position),t.u64(e.objectId),t.u64(e.ownerId),t.u32(e.skillId),t.u32(e.skillEffect)}function ks(t,e){let n={};return n.trapData=bu(t,e),n}function bs(t,e){Pu(t,e.trapData)}var Ps="NewTrap";function vs(t,e){let n={};return n.skillId=t.u32(),n.caster=t.u64(),n.newDirectionYaw=A(t),n.cancelReason=t.u8(),n.newPosition=N(t),n}function Ts(t,e){t.u32(e.skillId),t.u64(e.caster),X(t,e.newDirectionYaw),t.u8(e.cancelReason),F(t,e.newPosition)}var Is="SkillCancelNotify";function Es(t,e){let n={};return n.players=t.array(t.u8(),()=>{let o={};return o.name=t.string(20),o.stats=t.array(t.u8(),()=>{let s={};return s.id=t.u8(),s.value=t.u32(),s},100),e>=4&&(o.elixirs=t.array(t.u8(),()=>{let s={};return s.slot=t.u8(),s.entries=t.array(t.u8(),()=>{let i={};return i.level=t.u8(),i.id=t.u32(),i}),s},32)),e>=5&&(o.gems=t.array(t.u8(),()=>{let s={};s.id=t.u32(),s.skillId=t.u32(),s.type=t.u8(),s.value=t.u16()})),o},24),n}function xs(t,e){t.array(e.players,{maxLen:24,lenType:"u8"},n=>{t.string(n.name,20),t.array(n.stats,{maxLen:100,lenType:"u8"},o=>{t.u8(o.id),t.u32(o.value)}),t.array(n.elixirs,{maxLen:32,lenType:"u8"},o=>{t.u8(o.slot),t.array(o.entries,{maxLen:5,lenType:"u8"},s=>{t.u8(s.level),t.u32(s.id)})}),t.array(n.gems,{maxLen:20,lenType:"u8"},o=>{t.u32(o.id),t.u32(o.skillId),t.u8(o.type),t.u16(o.value)})})}var Ns="APP_StatApi";var yt=new Map([[101,[Pn,kn,bn]],[0,[En,Tn,In]],[1,[Dn,xn,Nn]],[2,[wn,gn,Rn]],[4,[An,Ln,Kn]],[5,[Mn,Bn,Cn]],[6,[Fn,jn,On]],[7,[Un,qn,Wn]],[8,[zn,Vn,Zn]],[9,[$n,Gn,Yn]],[10,[Xn,Jn,Qn]],[11,[eo,yn,Le]],[12,[ao,no,oo]],[13,[ro,so,io]],[14,[lo,mo,_o]],[15,[So,po,ho]],[16,[Po,ko,bo]],[17,[Io,vo,To]],[18,[No,Eo,xo]],[19,[Ro,Do,go]],[20,[Ko,wo,Lo]],[21,[Co,Ao,Bo]],[22,[Oo,Mo,jo]],[23,[Wo,Fo,qo]],[24,[Zo,Uo,Vo]],[25,[Go,zo,Ho]],[26,[Jo,Yo,$o]],[27,[yo,Qo,Xo]],[28,[na,ea,ta]],[29,[sa,oa,aa]],[30,[ua,ia,ra]],[31,[la,ma,_a]],[32,[da,fa,ca]],[34,[Sa,pa,ha]],[35,[Pa,ka,ba]],[36,[Ia,va,Ta]],[37,[Na,Ea,xa]],[38,[Ra,Da,ga]],[39,[Ka,wa,La]],[40,[Ca,Aa,Ba]],[41,[Oa,Ma,ja]],[42,[Wa,Fa,qa]],[43,[Za,Ua,Va]],[44,[Ga,za,Ha]],[45,[Ja,Ya,$a]],[46,[ya,Qa,Xa]],[47,[ns,es,ts]],[48,[ss,os,as]],[49,[us,is,rs]],[50,[ls,ms,_s]],[52,[ds,fs,cs]],[51,[Ss,ps,hs]],[53,[Ps,ks,bs]],[54,[Is,vs,Ts]],[6e4,[Ns,Es,xs]]]);var ee,se,Ae,gs=class{constructor(e,n,o){Q(this,ee,void 0);Q(this,se,void 0);Q(this,Ae,void 0);$(this,"ip");$(this,"zoneSyncStatus",0);$(this,"cache",new Map);o&&ne(this,ee,o),ne(this,se,e),ne(this,Ae,n)}syncData(){let e=[];g(this,se).entities.forEach(n=>{n.entityType===1&&e.push(n)}),this.getPlayersData(e)}getPlayersData(e,n=0){if(n>24){e.forEach(s=>{let i=this.cache.get(s.name);i&&i.status===1?i.status=0:i||this.cache.set(s.name,{hash:"",status:0,info:{name:s.name,stats:[],elixirs:[],gems:[]}})});return}if(!this.isCurrentZoneValid()){e.forEach(s=>{let i=this.cache.get(s.name);i&&i.status===1&&this.cache.delete(s.name)});return}if(!g(this,ee)||!this.ip)return;let o={};e.forEach(s=>{let i=this.getHash(s),a=this.cache.get(s.name);if(!i){a&&a.status===1&&this.cache.delete(s.name);return}a&&(a.status===0||n===0&&a.status===1||a.status===2&&a.hash===i)||(a?(a.hash=i,a.status=1):a={hash:i,status:1,info:{name:s.name,stats:[],elixirs:[],gems:[]}},this.cache.set(s.name,a),o[s.name]=i)}),Object.keys(o).length!==0&&Tu.default.get(`${gs.baseUrl}/req2`,{params:{ip:this.ip,ci:g(this,Ae),...o}}).then(s=>{if(s.status===200&&g(this,ee))try{let i=s.data,a=yt.get(6e4);if(a){let[m,c,l]=a,k={players:i};if(e=e.filter(h=>!i.find(v=>v.name===h.name)),e.length>0&&setTimeout(()=>{e=e.map(h=>g(this,se).getEntityByName(h.name)).filter(h=>h!==void 0&&h.entityType===1),this.getPlayersData(e,n+1)},1e4),k.players.length>0){let h=new oe(k,6e4,l);g(this,ee).emit(m,h),g(this,ee).emit("*",m,h),g(this,ee).appendLog(h)}}}catch{setTimeout(()=>{e=e.map(a=>g(this,se).getEntityByName(a.name)).filter(a=>a!==void 0&&a.entityType===1),this.getPlayersData(e,n+5)},1e4)}}).catch(s=>{setTimeout(()=>{e=e.map(i=>g(this,se).getEntityByName(i.name)).filter(i=>i!==void 0&&i.entityType===1),this.getPlayersData(e,n+5)},1e4)})}getHash(e){if(!e.items.equipList||e.characterId===0n||!e.class||e.name==="You")return;let n=new Array(32).fill(0);e.items.equipList?.forEach(s=>{n[s.slot]=s.id});let o=`${e.name}${e.class}${e.characterId}${n.join("")}`;return(0,vu.createHash)("md5").update(o).digest("hex")}updatePlayerStats(e){e.forEach(n=>{let o=this.cache.get(n.name);o?(o.info=n,o.status=2):this.cache.set(n.name,{hash:"",status:2,info:n})})}getStats(e){if(!this.isCurrentZoneValid())return;let n=this.cache.get(e);if(n&&n.status===2)return n.info.stats}isCurrentZoneValid(){return this.zoneSyncStatus!==0&&(this.zoneSyncStatus&10)===0}},Ke=gs;ee=new WeakMap,se=new WeakMap,Ae=new WeakMap,$(Ke,"baseUrl","https://la.herysia.com");var wm={isLive:!0,dontResetOnZoneChange:!1,resetAfterPhaseTransition:!1,splitOnPhaseTransition:!1},en=class extends Iu.TypedEmitter{#e;encounters;#o;#i;#a;#n;options;resetTimer;phaseTransitionResetRequest;phaseTransitionResetRequestTime;#t;constructor(e,n,o,s,i){super(),this.#o=e,this.#i=n,this.#a=o,this.#n=s,this.options={...wm,...i},this.resetTimer=null,this.phaseTransitionResetRequest=!1,this.phaseTransitionResetRequestTime=0,this.#t=new Map,this.encounters=[],this.#e={startedOn:0,lastCombatPacket:0,fightStartedOn:0,localPlayer:this.#o.localPlayer.name,currentBoss:void 0,killState:0,zoneLevel:De[0],entities:new Map,damageStatistics:{totalDamageDealt:0,topDamageDealt:0,totalDamageTaken:0,topDamageTaken:0,totalHealingDone:0,topHealingDone:0,totalShieldDone:0,topShieldDone:0,debuffs:new Map,buffs:new Map,topShieldGotten:0,totalEffectiveShieldingDone:0,topEffectiveShieldingDone:0,topEffectiveShieldingUsed:0,effectiveShieldingBuffs:new Map,appliedShieldingBuffs:new Map}}}onCounterAttack(e,n){let o=this.updateEntity(e,{},n);o.hits.counter+=1}onInitEnv(e,n){this.options.isLive?(this.#e.entities.forEach((o,s,i)=>{o.hits.total===0&&i.delete(s)}),this.options.dontResetOnZoneChange===!1&&this.resetTimer===null&&(this.resetTimer=setTimeout(()=>{this.resetState(+n+6e3)},6e3),this.emit("message","new-zone"))):(this.splitEncounter(n),this.emit("message","new-zone"))}splitEncounter(e){if(this.#e.fightStartedOn!==0&&(this.#e.damageStatistics.totalDamageDealt!==0||this.#e.damageStatistics.totalDamageTaken!==0)){let n=structuredClone(this.#e);n.entities.forEach(o=>{o.isPlayer&&(o.statApiValid=this.#a.isCurrentZoneValid()&&this.#a.cache.get(o.name)?.status===2)}),n.localPlayer=this.#o.localPlayer.name,this.applyBreakdowns(n.entities),this.encounters.push(n)}this.resetState(+e)}getBossIfStillExist(){if(this.#e.currentBoss?.id){let e=BigInt(`0x0${this.#e.currentBoss?.id}`);return this.#o.entities.has(e)?this.#e.currentBoss:void 0}}resetState(e){this.cancelReset(),this.resetBreakdowns(),this.#e={startedOn:+e,lastCombatPacket:+e,fightStartedOn:0,localPlayer:this.#o.localPlayer.name,currentBoss:this.getBossIfStillExist(),entities:new Map,killState:0,zoneLevel:this.#e.zoneLevel,damageStatistics:{totalDamageDealt:0,topDamageDealt:0,totalDamageTaken:0,topDamageTaken:0,totalHealingDone:0,topHealingDone:0,totalShieldDone:0,topShieldDone:0,debuffs:new Map,buffs:new Map,appliedShieldingBuffs:new Map,effectiveShieldingBuffs:new Map,topEffectiveShieldingDone:0,topEffectiveShieldingUsed:0,topShieldGotten:0,totalEffectiveShieldingDone:0}},this.emit("reset-state",this.#e)}cancelReset(){this.resetTimer&&clearTimeout(this.resetTimer),this.resetTimer=null}onPhaseTransition(e,n){this.options.isLive&&(this.emit("message",`phase-transition-${e}`),this.options.resetAfterPhaseTransition&&(this.phaseTransitionResetRequest=!0,this.phaseTransitionResetRequestTime=+n)),!this.options.isLive&&this.options.splitOnPhaseTransition&&this.splitEncounter(n)}updateOptions(e){this.options={...this.options,...e}}onDeath(e,n){let o=this.#e.entities.get(e.name),s=0;o?o.isDead?s=o.deaths:s=o.deaths+1:s=1,this.updateEntity(e,{isDead:!0,deathTime:+n,deaths:s},n)}onDamage(e,n,o,s,i,a){if((s.modifier&15)===11&&s.skillId===0&&s.skillEffectId===0)return;this.phaseTransitionResetRequest&&this.phaseTransitionResetRequestTime>0&&this.phaseTransitionResetRequestTime<+a-8e3&&(this.resetState(+a),this.phaseTransitionResetRequest=!1);let[m,c]=this.#i.getStatusEffects(e,o,this.#o.localPlayer.characterId,a);if(this.#n.isBattleItem(s.skillEffectId,"attack")&&n&&n.entityType===5){let C=n;s.skillEffectId=C.skillEffectId}let l=this.updateEntity(e,{},a),k=this.updateEntity(o,{currentHp:s.targetCurHp,maxHp:s.targetMaxHp},a);if(!l||!k)return;!k.isPlayer&&s.targetCurHp<0&&(s.damage=s.damage+s.targetCurHp);let h=s.skillId;s.skillId===0&&s.skillEffectId!==0&&(h=s.skillEffectId);let v=l.skills.get(h);v||(v={...this.createEntitySkill(),id:h,...this.getSkillNameIcon(s.skillId,s.skillEffectId)},l.skills.set(h,v));let G=s.modifier&15,L=(s.modifier>>4&7)-1,B=(G&9)!==0,J=new Set,j=new Set;m.forEach(([C])=>{J.add(C)}),c.forEach(([C])=>{j.add(C)}),v.damageInfo.damageDealt+=s.damage,s.damage>v.maxDamage&&(v.maxDamage=s.damage),l.hits.total+=1,v.hits.total+=1,l.damageInfo.damageDealt+=s.damage,k.damageTaken+=s.damage;let Bt=B?1:0;l.hits.crit+=Bt,v.hits.crit+=Bt;let Ct=!1,Mt=!1,jt=this.#n.getSkillEffectDirectionalMask(s.skillEffectId)-1;if(jt===0||jt===2){Mt=L===0;let C=Mt?1:0;l.hits.backAttack+=C,l.hits.totalBackAttack+=1,v.hits.backAttack+=C,v.hits.totalBackAttack+=1}if(jt===1||jt===2){Ct=L===1;let C=Ct?1:0;l.hits.frontAttack+=C,l.hits.totalFrontAttack+=1,v.hits.frontAttack+=C,v.hits.totalFrontAttack+=1}if(l.isPlayer){this.#e.damageStatistics.totalDamageDealt+=s.damage,this.#e.damageStatistics.topDamageDealt=Math.max(this.#e.damageStatistics.topDamageDealt,l.damageInfo.damageDealt);let C=!1,ce=!1;J.forEach(_=>{if(!this.#e.damageStatistics.buffs.has(_)){let D=this.#n.getStatusEffectHeaderData(_);D&&this.#e.damageStatistics.buffs.set(_,D)}let K=this.#e.damageStatistics.buffs.get(_);K&&!C&&(C=(K.buffcategory==="classskill"||K.buffcategory==="identity"||K.buffcategory==="ability")&&K.source.skill!==void 0&&K.target===1&&this.#n.isSupportClassId(K.source.skill.classid));let y=v.damageDealtBuffedBy.get(_)??0;v.damageDealtBuffedBy.set(_,y+s.damage);let de=l.damageDealtBuffedBy.get(_)??0;l.damageDealtBuffedBy.set(_,de+s.damage);let xe=l.hits.hitsBuffedBy.get(_)??0;l.hits.hitsBuffedBy.set(_,xe+1);let R=v.hits.hitsBuffedBy.get(_)??0;v.hits.hitsBuffedBy.set(_,R+1)}),j.forEach(_=>{if(!this.#e.damageStatistics.debuffs.has(_)){let D=this.#n.getStatusEffectHeaderData(_);D&&this.#e.damageStatistics.debuffs.set(_,D)}let K=this.#e.damageStatistics.debuffs.get(_);K&&!ce&&(ce=(K.buffcategory==="classskill"||K.buffcategory==="identity"||K.buffcategory==="ability")&&K.source.skill!==void 0&&K.target===1&&this.#n.isSupportClassId(K.source.skill.classid));let y=v.damageDealtDebuffedBy.get(_)??0;v.damageDealtDebuffedBy.set(_,y+s.damage);let de=l.damageDealtDebuffedBy.get(_)??0;l.damageDealtDebuffedBy.set(_,de+s.damage);let xe=l.hits.hitsDebuffedBy.get(_)??0;l.hits.hitsDebuffedBy.set(_,xe+1);let R=v.hits.hitsDebuffedBy.get(_)??0;v.hits.hitsDebuffedBy.set(_,R+1)});let qr=ce?1:0,Wr=C?1:0;if(v.damageInfo.damageDealtBuffedBySupport+=C?s.damage:0,v.damageInfo.damageDealtDebuffedBySupport+=ce?s.damage:0,l.damageInfo.damageDealtBuffedBySupport+=C?s.damage:0,l.damageInfo.damageDealtDebuffedBySupport+=ce?s.damage:0,l.hits.hitsBuffedBySupport+=Wr,l.hits.hitsDebuffedBySupport+=qr,v.hits.hitsBuffedBySupport+=Wr,v.hits.hitsDebuffedBySupport+=qr,s.damage>0&&l.isPlayer){let _={multDmg:{sumRate:0,totalRate:1,values:Array()},atkPowSubRate2:{selfSumRate:0,sumRate:0,values:Array()},atkPowSubRate1:{sumRate:0,totalRate:1,values:Array()},skillDamRate:{selfSumRate:0,sumRate:0,values:Array()},atkPowAmplify:{values:Array()},crit:{selfSumRate:0,sumRate:0,values:Array()},critDmgRate:2};if(m.forEach(([R,D,w])=>{let E=this.#o.entities.get(D);if(!E)return;let p=this.getBuffAfterTripods(this.#n.skillBuff.get(R),E,s);if(p){if(p.type==="skill_damage_amplify"&&p.statuseffectvalues&&E.entityType===1&&D!==e.entityId){let P=p.statuseffectvalues[0]??0,S=p.statuseffectvalues[4]??0;if((P===0||P===s.skillId)&&(S===0||S===s.skillEffectId)){let I=p.statuseffectvalues[1]??0;if(I!==0){let x=I/1e4*w;_.multDmg.values.push({casterEntity:E,rate:x}),_.multDmg.sumRate+=x,_.multDmg.totalRate*=1+x}}}else if(p.type==="attack_power_amplify"&&p.statuseffectvalues&&E.entityType===1&&D!==e.entityId){let P=p.statuseffectvalues[0]??0;if(P!==0){let S=P/1e4*w,I=this.#a.getStats(E.name)?.find(q=>q.id===4)?.value,x=this.#a.getStats(e.name)?.find(q=>q.id===4)?.value;I&&x&&(S*=I/x),_.atkPowAmplify.values.push({casterEntity:E,rate:S})}}p.passiveoption.forEach(P=>{if(ie[P.type]===2){if(P.keystat==="attack_power_sub_rate_2"){let S=P.value;if(S!==0){let I=S/1e4*w;E.entityType===1&&D!==e.entityId?(_.atkPowSubRate2.values.push({casterEntity:E,rate:I}),_.atkPowSubRate2.sumRate+=I):_.atkPowSubRate2.selfSumRate+=I}}else if(P.keystat==="attack_power_sub_rate_1"){let S=P.value;if(S!==0){let I=S/1e4*w;E.entityType===1&&D!==e.entityId&&(_.atkPowSubRate1.values.push({casterEntity:E,rate:I}),_.atkPowSubRate1.sumRate+=I,_.atkPowSubRate1.totalRate*=1+I)}}else if(P.keystat==="skill_damage_rate"){let S=P.value;if(S!==0){let I=S/1e4*w;E.entityType===1&&D!==e.entityId?(_.skillDamRate.values.push({casterEntity:E,rate:I}),_.skillDamRate.sumRate+=I):_.skillDamRate.selfSumRate+=I}}}if(P.keystat==="critical_hit_rate"){let S=P.value;if(S!==0){let I=S/1e4*w;E.entityType===1&&D!==e.entityId?(_.crit.values.push({casterEntity:E,rate:I}),_.crit.sumRate+=I):_.crit.selfSumRate+=I}}if(E.entityType===1&&D!==e.entityId)if(P.keystat==="skill_damage_sub_rate_2"){let S=P.value;if(S!==0){let I=S/1e4*w,x=this.#a.getStats(E.name)?.find(q=>q.id===1)?.value??0;switch(E.class){case 204:I*=1+x/.0699*.35/1e4;break;case 105:I*=1+x/.0699*.63/1e4;break;case 602:I*=1+x/.0699*.38/1e4;break;default:break}_.multDmg.values.push({casterEntity:E,rate:I}),_.multDmg.sumRate+=I,_.multDmg.totalRate*=1+I}}else P.keystat==="critical_dam_rate"&&p.category==="buff"&&(_.critDmgRate+=P.value/1e4*w);else if(ie[P.type]===4){let S=this.#n.combatEffect.get(P.keyindex);_.critDmgRate+=w*this.getCritMultiplierFromCombatEffect(S,{self:e,target:o,caster:E,skill:this.#n.skill.get(h),hitOption:L,targetCount:i})}})}}),c.forEach(([R,D,w])=>{let E=this.#o.entities.get(D);if(!E)return;let p=this.getBuffAfterTripods(this.#n.skillBuff.get(R),E,s);if(p){if(p.type==="instant_stat_amplify"&&p.statuseffectvalues){let P=p.statuseffectvalues[0]??0;if(P!==0){let S=P/1e4*w;E.entityType===1&&D!==e.entityId?(_.crit.values.push({casterEntity:E,rate:S}),_.crit.sumRate+=S):_.crit.selfSumRate+=S}}if(!(E.entityType!==1||D===e.entityId)){if(p.type==="instant_stat_amplify"&&p.statuseffectvalues){let P=p.statuseffectvalues[0]??0;if(s.damageType===0){let S=p.statuseffectvalues[2]??0;if(S!==0){let x=-(S/1e4)*w*.5;_.multDmg.values.push({casterEntity:E,rate:x}),_.multDmg.sumRate+=x,_.multDmg.totalRate*=1+x}let I=p.statuseffectvalues[7]??0;if(I!==0){let x=I/1e4*w;_.multDmg.values.push({casterEntity:E,rate:x}),_.multDmg.sumRate+=x,_.multDmg.totalRate*=1+x}if(B){let x=p.statuseffectvalues[9]??0;if(x!==0){let q=x/1e4*w;_.multDmg.values.push({casterEntity:E,rate:q}),_.multDmg.sumRate+=q,_.multDmg.totalRate*=1+q}}}else if(s.damageType===1){let S=p.statuseffectvalues[3]??0;if(S!==0){let x=-(S/1e4)*w*.5;_.multDmg.values.push({casterEntity:E,rate:x}),_.multDmg.sumRate+=x,_.multDmg.totalRate*=1+x}let I=p.statuseffectvalues[8]??0;if(I!==0){let x=I/1e4*w;_.multDmg.values.push({casterEntity:E,rate:x}),_.multDmg.sumRate+=x,_.multDmg.totalRate*=1+x}if(B){let x=p.statuseffectvalues[10]??0;if(x!==0){let q=x/1e4*w;_.multDmg.values.push({casterEntity:E,rate:q}),_.multDmg.sumRate+=q,_.multDmg.totalRate*=1+q}}}}if(p.type==="skill_damage_amplify"&&p.statuseffectvalues){let P=p.statuseffectvalues[0]??0,S=p.statuseffectvalues[4]??0;if((P===0||P===s.skillId)&&(S===0||S===s.skillEffectId)){let I=p.statuseffectvalues[1]??0;if(I!==0){let x=I/1e4*w;_.multDmg.values.push({casterEntity:E,rate:x}),_.multDmg.sumRate+=x,_.multDmg.totalRate*=1+x}}}if(p.type==="directional_attack_amplify"&&p.statuseffectvalues){if(Ct){let P=p.statuseffectvalues[0]??0;if(P!==0){let S=P/100*w;_.multDmg.values.push({casterEntity:E,rate:S}),_.multDmg.sumRate+=S,_.multDmg.totalRate*=1+S}}if(Mt){let P=p.statuseffectvalues[4]??0;if(P!==0){let S=P/100*w;_.multDmg.values.push({casterEntity:E,rate:S}),_.multDmg.sumRate+=S,_.multDmg.totalRate*=1+S}}}}}}),_.crit.values.length>0){let R=this.#n.skill.get(s.skillId);e.itemSet?.forEach(D=>{if(ie[D.type]===2&&Se[D.keystat]===76)_.critDmgRate+=D.value/1e4;else if(ie[D.type]===4){let w=this.#n.combatEffect.get(D.keyindex);_.critDmgRate+=this.getCritMultiplierFromCombatEffect(w,{self:e,target:o,caster:e,skill:R,hitOption:L,targetCount:i})}e.skills.get(s.skillId)?.tripods.forEach(w=>{let E=new Map;w.options.forEach(p=>{let P=qt[p.type];if(P===45){if((p.params[0]??0)===0||s.skillEffectId===(p.params[0]??0)){let S=p.params[1];if(S){let I=this.#n.combatEffect.get(S);I&&E.set(I.id,I)}}}else if(P===46)E.delete(p.params[0]??0);else if(P===104){if((p.params[0]??0)===0||s.skillEffectId===(p.params[0]??0)){let S=E.get(p.params[1]??0);if(S){let I=structuredClone(S);E.set(S.id,I),I.effects.forEach(x=>{x.actions.forEach(q=>{for(let pe=0;pe<p.params.length-2;pe++)Ft[p.paramtype]===1?q.args[pe]*=1+(p.params[pe+2]??0)/100:q.args[pe]+=p.params[pe+2]??0})})}}}else P===29?((p.params[0]??0)===0||s.skillEffectId===(p.params[0]??0))&&(_.critDmgRate+=(p.params[1]??0)/1e4):P===30&&((p.params[0]??0)===0||s.skillEffectId===(p.params[0]??0))&&(_.crit.selfSumRate+=(p.params[1]??0)/1e4)}),E.forEach(p=>{_.critDmgRate+=this.getCritMultiplierFromCombatEffect(p,{self:e,target:o,caster:e,skill:R,hitOption:L,targetCount:i})})})})}if(_.skillDamRate.values.length>0){let R=this.#a.getStats(e.name)?.find(D=>D.id===5)?.value;R&&(_.skillDamRate.selfSumRate+=R/1e4)}let K=0;if(_.crit.values.length>0){_.crit.selfSumRate+=(this.#a.getStats(e.name)?.find(D=>D.id===0)?.value??0)/.2794/1e4;let R=Math.min(Math.max(0,1-_.crit.selfSumRate),_.crit.sumRate);K=(R*_.critDmgRate-R)/(_.crit.selfSumRate*_.critDmgRate-_.crit.selfSumRate+1)}let y=_.atkPowAmplify.values.length<=0?{rate:0}:_.atkPowAmplify.values.reduce((R,D)=>R.rate>D.rate?R:D),de=(1+K)*(1+_.atkPowSubRate2.sumRate/(1+_.atkPowSubRate2.selfSumRate))*(1+_.skillDamRate.sumRate/(1+_.skillDamRate.selfSumRate))*(1+y.rate)*_.multDmg.totalRate*_.atkPowSubRate1.totalRate-1,xe=K+_.atkPowSubRate2.sumRate/(1+_.atkPowSubRate2.selfSumRate)+_.skillDamRate.sumRate/(1+_.skillDamRate.selfSumRate)+y.rate+(_.multDmg.totalRate-1)+(_.atkPowSubRate1.totalRate-1);{let R=de*s.damage/(xe*(1+de)),D=K*R/_.crit.sumRate;_.crit.values.forEach(p=>{let P=p.rate*D,S=this.#e.entities.get(p.casterEntity.name);this.applyRdps(l,S,v,P)}),_.atkPowSubRate2.values.forEach(p=>{let P=p.rate/(1+_.atkPowSubRate2.selfSumRate)*R,S=this.#e.entities.get(p.casterEntity.name);this.applyRdps(l,S,v,P)}),_.skillDamRate.values.forEach(p=>{let P=p.rate/(1+_.skillDamRate.selfSumRate)*R,S=this.#e.entities.get(p.casterEntity.name);this.applyRdps(l,S,v,P)});let w=(_.multDmg.totalRate-1)*R/_.multDmg.sumRate;_.multDmg.values.forEach(p=>{let P=p.rate*w,S=this.#e.entities.get(p.casterEntity.name);this.applyRdps(l,S,v,P)});let E=(_.atkPowSubRate1.totalRate-1)*R/_.atkPowSubRate1.sumRate;if(_.atkPowSubRate1.values.forEach(p=>{let P=p.rate*E,S=this.#e.entities.get(p.casterEntity.name);this.applyRdps(l,S,v,P)}),y.rate>0){let p=y.rate*R,P=this.#e.entities.get(y.casterEntity?.name);this.applyRdps(l,P,v,p)}}}let b={timestamp:+a,damage:s.damage,targetEntity:k.id,isCrit:B,isBackAttack:Mt,isFrontAttack:Ct,isBuffedBySupport:C,isDebuffedBySupport:ce,buffedBy:[...J],debuffedBy:[...j]},em=BigInt("0x"+l.id);this.addBreakdown(em,h,b)}k.isPlayer&&(this.#e.damageStatistics.totalDamageTaken+=s.damage,this.#e.damageStatistics.topDamageTaken=Math.max(this.#e.damageStatistics.topDamageTaken,k.damageTaken)),k.isBoss&&(this.#e.currentBoss=k),this.#e.fightStartedOn===0&&(this.#e.fightStartedOn=+a),this.#e.lastCombatPacket=+a}getBuffAfterTripods(e,n,o){if(!e||n.entityType!==1)return e;let s=structuredClone(e);return n.skills.get(o.skillId)?.tripods.forEach(i=>{i.options.forEach(a=>{let m=qt[a.type];if(m===19){if(((a.params[0]??0)===0||o.skillEffectId===(a.params[0]??0))&&s.id===(a.params[1]??0)){let c=new Map;for(let l=2;l<a.params.length;l+=2)a.params[l]&&a.params[l+1]&&c.set(a.params[l]??0,a.params[l+1]??0);s.passiveoption.forEach(l=>{let k=c.get(Se[l.keystat]);ie[l.type]===2&&k&&(Ft[a.paramtype]===0?l.value+=k:l.value*=1+k/100)})}}else if(m===42){if(((a.params[0]??0)===0||o.skillEffectId===(a.params[0]??0))&&s.id===(a.params[1]??0)){let c=Se[a.params[2]??0],l=a.params[3]??0;c&&l!==void 0&&s.passiveoption.push({type:"stat",keystat:c,keyindex:0,value:l})}}else if(m===21&&s.statuseffectvalues&&((a.params[0]??0)===0||o.skillEffectId===(a.params[0]??0))&&s.id===(a.params[1]??0))if((a.params[2]??0)===0)s.statuseffectvalues=a.params.slice(3);else{let c=[];for(let l=0;l<Math.max(s.statuseffectvalues.length,a.params.length-3);l++)a.params[l+3]&&c.push((s.statuseffectvalues[l]??0)*(1+(a.params[l+3]??0)/100));s.statuseffectvalues=c}})}),s}getCritMultiplierFromCombatEffect(e,n){if(!e)return 0;let o=0;return e.effects.filter(s=>s.actions.find(i=>Ot[i.type]===4)).forEach(s=>{this.#n.isCombatEffectConditionsValid({effect:s,...n})&&s.actions.filter(i=>Ot[i.type]===4).forEach(i=>{o+=(i.args[0]??0)/100})}),o}applyRdps(e,n,o,s){n&&(n.damageInfo.rdpsDamageGiven+=s),n&&this.#n.isSupportClassId(n.classId)&&(e.damageInfo.rdpsDamageReceivedSupp+=s,o.damageInfo.rdpsDamageReceivedSupp+=s),e.damageInfo.rdpsDamageReceived+=s,o.damageInfo.rdpsDamageReceived+=s}onStartSkill(e,n,o){let s=this.updateEntity(e,{isDead:!1},o);if(s){s.hits.casts+=1;let i=s.skills.get(n);i||(i={...this.createEntitySkill(),id:n,...this.getSkillNameIcon(n,0)},s.skills.set(n,i)),i.hits.casts+=1}}onShieldUsed(e,n,o,s){if(s<0&&console.error("Shield change values was negative, shield ammount increased"),e.entityType===1&&n.entityType===1){if(!this.#e.damageStatistics.effectiveShieldingBuffs.has(o)){let k=this.#n.getStatusEffectHeaderData(o);k&&this.#e.damageStatistics.effectiveShieldingBuffs.set(o,k)}let i=new Date,a=this.updateEntity(e,{},i),m=this.updateEntity(n,{},i);a.damagePreventedByShield+=s;let c=a.damagePreventedByShieldBy.get(o)??0;a.damagePreventedByShieldBy.set(o,c+s),this.#e.damageStatistics.topEffectiveShieldingUsed=Math.max(a.damagePreventedByShield,this.#e.damageStatistics.topEffectiveShieldingUsed),m.damagePreventedWithShieldOnOthers+=s;let l=m.damagePreventedWithShieldOnOthersBy.get(o)??0;m.damagePreventedWithShieldOnOthersBy.set(o,l+s),this.#e.damageStatistics.topEffectiveShieldingDone=Math.max(m.damagePreventedWithShieldOnOthers,this.#e.damageStatistics.topEffectiveShieldingDone),this.#e.damageStatistics.totalEffectiveShieldingDone+=s}}onShieldApplied(e,n,o,s){let i=new Date,a=this.updateEntity(e,{},i),m=this.updateEntity(n,{},i);if(m.isPlayer&&a.isPlayer){if(!this.#e.damageStatistics.appliedShieldingBuffs.has(o)){let k=this.#n.getStatusEffectHeaderData(o);k&&this.#e.damageStatistics.appliedShieldingBuffs.set(o,k)}a.shieldReceived+=s,m.shieldDone+=s;let c=m.shieldDoneBy.get(o)??0;m.shieldDoneBy.set(o,c+s);let l=a.shieldReceivedBy.get(o)??0;a.shieldReceivedBy.set(o,l+s),this.#e.damageStatistics.topShieldDone=Math.max(m.shieldDone,this.#e.damageStatistics.topShieldDone),this.#e.damageStatistics.topShieldGotten=Math.max(a.shieldReceived,this.#e.damageStatistics.topShieldGotten),this.#e.damageStatistics.totalShieldDone+=s}}getSkillNameIcon(e,n){if(e===0&&n===0)return{name:"Bleed",icon:"buff_168.png"};if(e===0){let o=this.#n.skillEffect.get(n);if(o&&o.itemname)return{name:o.itemname,icon:o.icon??""};if(o){if(o.sourceskill){let s=this.#n.skill.get(o.sourceskill);if(s)return{name:s.name,icon:s.icon}}else{let s=this.#n.skill.get(Math.floor(n/10));if(s)return{name:s.name,icon:s.icon}}return{name:o.comment}}else return{name:this.#n.getSkillName(e)}}else{let o=this.#n.skill.get(e);return!o&&(o=this.#n.skill.get(e-e%10),!o)?{name:this.#n.getSkillName(e),icon:""}:o.summonsourceskill?(o=this.#n.skill.get(o.summonsourceskill),o?{name:o.name+" (Summon)",icon:o.icon}:{name:this.#n.getSkillName(e),icon:""}):o.sourceskill?(o=this.#n.skill.get(o.sourceskill),o?{name:o.name,icon:o.icon}:{name:this.#n.getSkillName(e),icon:""}):{name:o.name,icon:o.icon}}}updateEntity(e,n,o){let s={lastUpdate:+o},i=this.#e.entities.get(e.name),a={};if(!i||e.entityType===1&&i.isPlayer!==!0){if(e.entityType===1){let m=e;a={classId:m.class,gearScore:m.gearLevel,isPlayer:!0}}else if(e.entityType===2||e.entityType===3){let m=e;a={npcId:m.typeId,isBoss:m.isBoss}}else if(e.entityType===4){let m=e;a={npcId:m.typeId,isBoss:m.isBoss,isEsther:!0,icon:m.icon}}}return i?Object.assign(i,n,s,a):(i={...this.createEntity(),...n,...s,...a,name:e.name,id:e.entityId.toString(16)},this.#e.entities.set(e.name,i)),i}updateOrCreateEntity(e,n,o){if(!(!n.name||!n.id)){for(let[s,i]of this.#e.entities)if(n.id===i.id){this.#e.entities.delete(s),this.updateEntity(e,{...i,...n},o);return}this.updateEntity(e,n,o)}}createEntitySkill(){return{id:0,name:"",icon:"",damageInfo:{damageDealt:0,rdpsDamageReceived:0,rdpsDamageReceivedSupp:0,rdpsDamageGiven:0,damageDealtDebuffedBySupport:0,damageDealtBuffedBySupport:0},maxDamage:0,hits:{casts:0,total:0,crit:0,backAttack:0,totalBackAttack:0,frontAttack:0,totalFrontAttack:0,counter:0,hitsDebuffedBySupport:0,hitsBuffedBySupport:0,hitsBuffedBy:new Map,hitsDebuffedBy:new Map},breakdown:[],damageDealtDebuffedBy:new Map,damageDealtBuffedBy:new Map}}createEntity(){return{lastUpdate:0,id:"",npcId:0,name:"",classId:0,isBoss:!1,isPlayer:!1,isDead:!1,deaths:0,deathTime:0,gearScore:0,currentHp:0,maxHp:0,damageInfo:{damageDealt:0,rdpsDamageReceived:0,rdpsDamageReceivedSupp:0,rdpsDamageGiven:0,damageDealtDebuffedBySupport:0,damageDealtBuffedBySupport:0},healingDone:0,shieldDone:0,damageTaken:0,skills:new Map,hits:{casts:0,total:0,crit:0,backAttack:0,totalBackAttack:0,frontAttack:0,totalFrontAttack:0,counter:0,hitsDebuffedBySupport:0,hitsBuffedBySupport:0,hitsBuffedBy:new Map,hitsDebuffedBy:new Map},damageDealtDebuffedBy:new Map,damageDealtBuffedBy:new Map,damagePreventedByShieldBy:new Map,damagePreventedWithShieldOnOthersBy:new Map,shieldDoneBy:new Map,shieldReceivedBy:new Map,damagePreventedWithShieldOnOthers:0,damagePreventedByShield:0,shieldReceived:0,statApiValid:!1}}getBroadcast(){let e={...this.#e};return e.entities=new Map,this.#e.entities.forEach((n,o)=>{!n.isPlayer&&!n.isEsther||(n.statApiValid=this.#a.isCurrentZoneValid()&&this.#a.cache.get(n.name)?.status===2,e.entities.set(o,{...n}))}),e.localPlayer=this.#o.localPlayer.name,e}resetBreakdowns(){this.#t.clear()}createBreakdownEntity(e){return this.#t.has(e)||this.#t.set(e,new Map),this.#t.get(e)}removeBreakdownEntry(e){this.#t.delete(e)}addBreakdown(e,n,o){let s=this.createBreakdownEntity(e);if(s.has(n))s.get(n).push(o);else{let i=new Array(o);s.set(n,i)}}getBreakdowns(e,n){let o=this.#t.get(e);if(o)return o.get(n)}clearBreakdowns(e,n){let o=this.#t.get(e);o&&o.delete(n)}applyBreakdowns(e,n=!0){e.forEach(o=>{o.skills.forEach(s=>{let i=BigInt("0x"+o.id),a=this.getBreakdowns(i,s.id);a&&(s.breakdown=[...a])})}),n&&this.resetBreakdowns()}setKillState(e){this.#e.killState=e}setZoneLevel(e){this.#e.zoneLevel=De[e]}};var Ju=require("tiny-typed-emitter");function Rs(t){let e=new f(t),n={};return e.skip(4),n.cooldown1=e.f32(),n.cooldown2=e.f32(),n.skillId=e.u32(),n}var ws="PKTSkillCooldownNotify",Be=49035;function Ie(t){let e={};return e.points=t.u16(),e.level=t.u8(),e.id=t.u32(),e}function Ks(t){let e=new f(t),n={};return n.abilityDataList=e.array(e.u16(),()=>Ie(e),100),n}var As="PKTAbilityChangeNotify",Ce=44427;function Eu(t){let e={};return e.level=t.u32(),e.featureType=t.u16(),e}function Bs(t){let e=new f(t),n={};return n.activeAbilityList=e.array(e.u16(),()=>Eu(e),60),n.objectId=e.u64(),n}var Cs="PKTActiveAbilityNotify",Me=29225;function Ms(t){let e=new f(t),n={};return n.addonFeatureIdList=e.bytes(e.u16(),200,4),n.addonSkillFeatureList=e.array(e.u16(),()=>{let o={};return o.addonSkillFeatureIdList=e.array(e.u16(),()=>e.u32(),5),o.skillId=e.u32(),o},200),n.objectId=e.u64(),n}var js="PKTAddonSkillFeatureChangeNotify",je=26726;function Os(t){let e=new f(t),n={};return n.packetResultCode=e.u32(),n.unk1_m=e.bytes(e.u32(),688),n}var Fs="PKTAuthTokenResult",qs=14686;function Ws(t){let e=new f(t),n={};return n.paralyzationPoint=e.u32(),n.type=e.u8(),e.skip(1),n.objectId=e.u64(),n.paralyzationMaxPoint=e.u32(),n}var Us="PKTBlockSkillStateNotify",Oe=26677;function Vs(t){let e=new f(t),n={};return n.targetId=e.u64(),n.sourceId=e.u64(),n.type=e.u32(),e.skip(1),n}var Zs="PKTCounterAttackNotify",Fe=13330;function zs(t){let e=new f(t),n={};return n.unk0_m=e.u64(),e.bool()&&(n.abnormalStatusType=e.u8()),n.effectId=e.u32(),n.sourceId=e.u64(),n.targetId=e.u64(),n.durabilityDecrement=e.u8(),n.directionYaw=e.u16(),e.bool()&&(n.damageAttr=e.u8()),n.unk2_m=e.u32(),e.bool()&&(n.deathType=e.u8()),n}var Hs="PKTDeathNotify",qe=40622;function te(t){let e={};return t.bool()&&(e.unk1_0=t.u8()),e.level=t.u16(),e.itemTint=t.bytes(t.u16(),5,14),e.unk4=t.u8(),e.expireTime=W(t),e.slot=t.u16(),e.id=t.u32(),e}function Gs(t){let e=new f(t),n={};return n.objectId=e.u64(),n.unk1=e.u32(),n.unk2=e.u32(),n.equipItemDataList=e.array(e.u16(),()=>te(e),33),n}var Ys="PKTEquipChangeNotify",We=47337;function $s(t){let e=new f(t),n={};return n.equipLifeToolDataList=e.array(e.u16(),()=>te(e),9),n.objectId=e.u64(),n}var Js="PKTEquipLifeToolChangeNotify",Ue=29994;function Qs(t){let e=new f(t),n={};return n.objectId=e.u64(),e.skip(1),n.stance=e.u8(),n}var Xs="PKTIdentityStanceChangeNotify",Ve=58886;function ys(t){let e=new f(t),n={};return n.struct_140=e.bytes(e.u16(),353,48),n.abilityDataList=e.array(e.u16(),()=>Ie(e),100),n}var ei="PKTInitAbility",Ze=33308;function ti(t){let e=new f(t),n={};return n.lostArkDateTime=W(e),n.unk1=e.u64(),n.unk2=e.u32(),n.playerId=e.u64(),n.unk4=e.u32(),n.struct_33=e.array(e.u16(),()=>{let o={};return o.versionString=e.string(64),o.struct_580=e.string(32),o.struct_597=e.string(128),o},64),n.struct_597=e.string(128),n.unk7=e.u8(),n}var ni="PKTInitEnv",ze=56231;function Ee(t){let e={};return e.unk0=t.u8(),e.unk1=t.u8(),e.unk2=T(t),e.unk3=t.u16(),e.unk4=t.u64(),e.unk5=T(t),e.unk6=t.u8(),e}function H(t){let e={};return e.stackCount=t.u8(),t.bool()&&(e.value=t.bytes(16)),e.skillLevel=t.u8(),e.sourceId=t.u64(),e.effectInstanceId=t.u32(),e.struct_442=t.bytes(t.u16(),8,7),e.statusEffectId=t.u32(),t.bool()&&(e.unk9_0=t.u64()),e.occurTime=W(t),e.endTick=t.u64(),e.totalTime=t.f32(),e}function ai(t){let e=new f(t),n={};return n.unk0=e.u32(),n.unk1=e.u32(),n.unk2=e.u16(),n.unk3=e.u32(),n.unk4=e.u8(),n.characterId=e.u64(),n.unk6=e.u8(),n.unk7=e.u8(),n.struct_336=e.string(7),n.unk9=e.bytes(35),n.unk10=e.u32(),n.unk11=e.u8(),n.struct_342=e.bytes(e.u16(),104,30),n.unk13=e.u8(),n.unk14=e.u32(),n.unk15=e.u32(),n.unk16=e.u32(),n.unk17=e.u8(),n.statPair=e.array(e.u16(),()=>{let o={};return o.value=T(e),o.statType=e.u8(),o},153),n.unk19=e.u32(),n.level=e.u16(),n.unk21=e.u8(),n.unk22=e.u64(),n.unk23=e.u32(),n.unk24=e.u64(),e.bool()&&(n.unk26_0=e.u32()),n.unk27=e.u16(),n.struct_226=e.bytes(e.u16(),3,17),n.unk29=e.u8(),n.unk30=e.u64(),n.unk31=e.u32(),n.unk32=e.u64(),n.unk33=e.u8(),n.unk34=e.u8(),n.unk35=e.u8(),n.unk36=e.bytes(25),n.unk37=e.u64(),n.playerId=e.u64(),n.unk39=e.u8(),n.unk40=e.u16(),n.unk41=e.u8(),n.classId=e.u16(),n.unk43=e.u8(),n.unk44=e.u8(),n.unk45=e.u8(),n.name=e.string(20),n.struct_109=e.bytes(e.u16(),64),n.unk48=e.u32(),n.unk49=e.bytes(120),n.unk50=e.u8(),n.gearLevel=e.f32(),n.unk52=e.u8(),n.unk53=e.u8(),n.periodUpdateStatDataList=e.array(e.u16(),()=>Ee(e),5),n.unk55=e.u16(),n.statusEffectDatas=e.array(e.u16(),()=>H(e),80),n.unk57=e.u8(),n}var si="PKTInitPC",He=1329;function xu(t){let e={},n=t.u16();return n===1&&(e.unk1_0=t.bytes(n)),e}function Nu(t){let e={};return e.struct_149=t.bytes(t.u16(),3,9),e.unk1=t.u8(),e.unk2=t.u8(),e.unk3=t.u32(),e.unk4=t.u8(),e.struct_148=xu(t),e.unk6=t.u32(),e.unk7=t.u8(),e}function Du(t){let e={};return e.struct_236=t.array(t.u16(),()=>Nu(t),3),e.unk1=t.u32(),e.unk2=t.u32(),e.unk3=t.u16(),e.unk4=t.u32(),e.unk5=t.u32(),e.unk6=t.u32(),e.struct_261=t.bytes(t.u16(),2,9),e.struct_393=t.bytes(t.u16(),2,10),e.struct_238=t.bytes(t.u16(),10,18),e.unk10=t.u8(),e.struct_150=t.bytes(t.u16(),10,9),e.unk12=t.u64(),e.unk13=t.u32(),e}function gu(t){let e={};return e.unk0=t.u8(),e.unk1=t.u8(),e.unk2=t.u16(),e.unk3=t.u8(),e.unk4=t.u16(),e.unk5=t.bytes(3),e.unk6=t.u16(),e.struct_102=t.bytes(t.u32(),51),e}function Ru(t){let e={};return e.unk0=t.u8(),e.unk1=t.bytes(t.u16(),7),t.bool()&&(e.struct_750=gu(t)),e.unk4=t.bytes(t.u16(),7),e}function wu(t){let e={};return e.unk0=t.u32(),e.struct_272=t.bytes(t.u16(),3,21),e.unk2=t.u32(),e.unk3=t.u32(),e.struct_437=t.bytes(t.u16(),3,10),e.unk5=t.u8(),e.struct_234=t.bytes(t.u16(),3,7),t.bool()&&(e.struct_790=Ru(t)),e.struct_240=t.bytes(t.u16(),10,29),t.bool()&&(e.struct_231=t.bytes(t.u16(),2,32)),e.unk12=t.u32(),e.itemTint=t.bytes(t.u16(),5,14),t.bool()&&(e.unk1_0=t.u32(),e.unk1_1=t.u32(),e.struct_194=t.bytes(t.u16(),5,30)),e.unk15=t.u32(),t.bool()&&(e.unk17_0=t.bytes(9)),e.unk18=t.u32(),t.bool()&&(e.unk20_0=t.bytes(10)),e}function nn(t){let e={};return e.npcId=t.u32(),e.isDead=t.bool(),e}function Ku(t){let e={};return e.unk0=t.u8(),e.struct_1=t.array(t.u16(),()=>{let n={};return n.struct_530=t.bytes(t.u16(),10),n.unk1_0_1=t.u32(),n},3),e.unk2=t.u32(),e.bossKillDataList=t.array(t.u16(),()=>nn(t),3),e.unk4=t.u8(),e}function Au(t){let e={};return e.struct_235=t.bytes(t.u16(),5,7),e.unk1=t.u8(),e.unk2=t.u8(),e.unk3=t.u8(),e.struct_234=t.bytes(t.u16(),3,7),e.struct_26=t.array(t.u16(),()=>{let n={};return n.unk1_0_0=t.u16(),n.struct_233=t.string(2),n.unk1_0_2=t.u8(),n},20),e}function Bu(t){let e={},n=t.u8();return n===1&&(e.struct_666=Du(t)),n===2&&(e.struct_137=t.bytes(t.u16(),3,6),e.unk2_1=t.u8(),e.struct_2=t.array(t.u16(),()=>{let o={};return o.unk1_0_0=t.u8(),o.unk1_0_1=t.u32(),o.struct_530=t.bytes(t.u16(),10),o.unk1_0_3=t.u8(),o},3)),n===3&&(e.unk3_0=t.bytes(26)),n===4&&(e.unk4_0=t.bytes(t.u16(),10,13),e.unk4_1=t.bytes(t.u16(),10,13),e.unk4_2=t.u32()),n===5&&(e.struct_665=wu(t)),n===6&&(e.struct_612=Ku(t)),n===7&&(e.unk7_0=t.bytes(9)),n===8&&(e.struct_658=Au(t)),n===9&&(e.unk9_0=t.u8()),e}function Cu(t){let e={};return t.u32()>0&&(e.serialNumber=t.u64(),e.id=t.u32(),e.level=t.u16(),e.slot=t.u16(),e.durability=t.u32(),e.unk1_6_m=t.u32(),e.flag=t.u32(),e.expireTime=W(t),e.lockUpdateTime=W(t),t.bool()&&(e.unk1_10_0=t.bytes(9)),e.unk1_11=t.u8(),e.unk1_12=t.u8(),e.unk1_13=t.u32(),e.struct_567=Bu(t),e.unk1_15=t.u32()),e}function ii(t){let e=new f(t),n={};return n.itemDataList=e.array(e.u16(),()=>Cu(e),80),n.storageType=e.u8(),n}var ri="PKTInitItem",Ge=14657;function Mu(t){let e={};return t.bool()&&(e.unk1_0=t.bytes(9)),t.bool()&&(e.unk3_0=t.u32()),e.unk4=t.u32(),e.unk5=t.u32(),e.unk6=t.u32(),e}function ui(t){let e=new f(t),n={};return n.addonFeatureIdList=e.bytes(e.u16(),200,4),n.statusEffectDatas=e.array(e.u16(),()=>H(e),80),n.addonSkillFeatureList=e.array(e.u16(),()=>{let o={};return o.addonSkillFeatureIdList=e.array(e.u16(),()=>e.u32(),5),o.skillId=e.u32(),o},200),n.unk3=e.u8(),n.unk4=e.u64(),n.unk5=e.u32(),e.bool()&&(n.unk7_0=e.u32()),n.struct_140=e.bytes(e.u16(),353,48),n.statPair=e.array(e.u16(),()=>{let o={};return o.value=T(e),o.statType=e.u8(),o},153),n.struct_226=e.bytes(e.u16(),3,17),n.unk11=e.u8(),n.unk12=e.u64(),n.struct_342=e.bytes(e.u16(),104,30),n.abilityDataList=e.array(e.u16(),()=>Ie(e),100),n.unk15=e.u8(),n.struct_421=e.array(e.u16(),()=>Mu(e),300),n}var mi="PKTInitLocal",Ye=18172;function _i(t){let e=new f(t),n={};return n.serverAddr=e.string(256),n.account_CharacterId1=e.u64(),n.account_CharacterId2=e.u64(),n.unk3=e.u32(),n}var li="PKTMigrationExecute",$e=1184;function ju(t){let e={};return e.unk0=t.u64(),e.unk1=t.u16(),e.unk2=t.u64(),e.unk3=t.u8(),e.lostArkString=t.string(20),e.unk5=t.u8(),e.equipItemDataList=t.array(t.u16(),()=>te(t),33),e.unk7=t.u8(),e.lookData=t.bytes(t.u32(),512),e}function on(t){let e={};return t.bool()&&(e.unk1_0=t.u64()),t.bool()&&(e.struct_734=ju(t)),t.bool()&&(e.unk5_0=t.u8()),t.bool()&&(e.balanceLevel=t.u16()),t.bool()&&(e.transitIndex=t.u32()),t.bool()&&(e.unk11_0=t.u16()),e.level=t.u16(),e.unk13=t.u8(),t.bool()&&(e.unk15_0=t.u32()),t.bool()&&(e.unk17_0=t.u8()),t.bool()&&(e.unk19_0=t.u8()),t.bool()&&(e.unk21_0=t.u32()),e.statPair=t.array(t.u16(),()=>{let n={};return n.value=T(t),n.statType=t.u8(),n},153),t.bool()&&(e.unk24_0=t.u8()),t.bool()&&(e.unk26_0=t.u8()),e.statusEffectDatas=t.array(t.u16(),()=>H(t),80),t.bool()&&(e.unk29_0=t.u32()),e.position=N(t),e.spawnIndex=t.u32(),t.bool()&&(e.unk33_0=t.u32()),e.objectId=t.u64(),t.bool()&&(e.struct_273=t.bytes(t.u16(),12,12)),t.bool()&&(e.unk38_0=t.u8()),e.unk39=t.u8(),e.unk40=t.u8(),t.bool()&&(e.struct_337=t.bytes(t.u16(),11,9)),e.periodUpdateStatDataList=t.array(t.u16(),()=>Ee(t),5),t.bool()&&(e.unk45_0=t.u8()),e.unk46=t.u8(),e.unk47=t.u8(),e.typeId=t.u32(),e.directionYaw=A(t),e.unk50=t.u8(),e}function fi(t){let e=new f(t),n={};return e.bool()&&(n.unk1_0=e.u8()),n.unk2=e.u8(),n.npcStruct=on(e),e.bool()&&(n.unk5_0=e.u64()),e.bool()&&(n.unk1_0_0=e.string(20),n.unk1_1=e.string(20)),n}var ci="PKTNewNpc",Je=50175;function di(t){let e=new f(t),n={};return n.npcData=on(e),e.skip(34),n.ownerId=e.u64(),e.skip(1),n.publishReason=e.u8(),n}var pi="PKTNewNpcSummon",Qe=8401;function Fu(t){let e={};return e.unk0=t.bytes(12),e.unk1=t.u32(),t.bool()&&(e.unk3_0=t.bytes(12)),e.unk4=t.u32(),e}function qu(t){let e={};return e.avgItemLevel=t.f32(),e.equipLifeToolDataList=t.array(t.u16(),()=>te(t),9),e.unk2=t.u32(),e.unk23_m=t.u8(),e.unk0_m=t.bytes(5),e.addonSkillFeatureList=t.array(t.u16(),()=>{let n={};return n.addonSkillFeatureIdList=t.array(t.u16(),()=>t.u32(),5),n.skillId=t.u32(),n},200),e.rvRLevel=t.u16(),e.lookData=t.bytes(t.u32(),512),e.guildName=t.string(20),e.unk1_m=t.u8(),e.firstHonorTitleId=t.u16(),e.worldId=t.u8(),e.unk29_m=t.u8(),e.statusEffectDatas=t.array(t.u16(),()=>H(t),80),e.unk14=t.u32(),e.unk4_m=t.u32(),e.level=t.u16(),e.unk17_m=t.u8(),e.addonFeatureIdList=t.bytes(t.u16(),200,4),e.unk45_m=t.u32(),e.position=N(t),e.name=t.string(20),e.equipItemDataList=t.array(t.u16(),()=>te(t),33),e.unk23=t.u8(),e.guildId=t.u64(),e.periodUpdateStatDataList=t.array(t.u16(),()=>Ee(t),5),e.unk5_m=t.u32(),e.unk27=t.u8(),e.unk28=t.u32(),e.unk29=t.u8(),e.classId=t.u16(),e.avatarHide=t.u8(),e.unk32=t.u64(),e.statPair=t.array(t.u16(),()=>{let n={};return n.value=T(t),n.statType=t.u8(),n},153),e.maxItemLevel=t.f32(),e.unk7_m=t.u32(),e.unk2_m=t.u8(),e.identityData=t.bytes(25),e.playerId=t.u64(),e.petId=t.u32(),e.secondHonorTitleId=t.u16(),t.bool()&&(e.grabbedData=t.bytes(12)),e.heading=A(t),e.unk32_m=t.u8(),e.unk25_m=t.u8(),e.characterId=t.u64(),e}function hi(t){let e=new f(t),n={};return n.unk2_m=e.u8(),e.bool()&&(n.struct_64=e.array(e.u16(),()=>{let o={};return o.unk1_0_0=e.u32(),o.unk1_0_1=e.u64(),o.itemTint=e.bytes(e.u16(),5,14),o},5)),e.bool()&&(n.itemTint=e.bytes(e.u16(),5,14),n.unk1_1=e.u64(),n.unk1_2=e.u32()),n.unk0_m=e.u8(),e.bool()&&(n.trackMoveInfo=Fu(e)),n.pcStruct=qu(e),e.bool()&&(n.unk4_0_m=e.bytes(12)),e.bool()&&(n.unk5_0_m=e.bytes(20)),e.bool()&&(n.unk3_0_m=e.u32()),n}var Si="PKTNewPC",Xe=24705;function Wu(t){let e={};return e.unk0=t.u8(),t.bool()&&(e.unk2_0=t.u64()),e.tripodLevel=Te(t),e.unk4=t.u32(),e.unk5=t.u32(),e.unk6=t.u16(),e.targetObjectId=t.u64(),e.ownerId=t.u64(),e.unk9=t.u8(),e.unk10=t.u64(),t.bool()&&(e.unk12_0=t.u32()),t.bool()&&(e.struct_337=t.bytes(t.u16(),11,9)),e.tripodIndex=ve(t),e.chainSkillEffect=t.u32(),e.skillLevel=t.u8(),e.unk18=t.u16(),e.skillId=t.u32(),e.projectileId=t.u64(),e.unk21=t.u32(),e.skillEffect=t.u32(),e.unk23=t.u64(),e}function ki(t){let e=new f(t),n={};return n.projectileInfo=Wu(e),n}var bi="PKTNewProjectile",ye=44644;function Uu(t){let e={};return e.ownerId=t.u64(),e.objectId=t.u64(),e.skillId=t.u32(),e.unk3=t.u32(),e.unk4=t.u32(),e.unk5=t.u32(),e.unk6=t.u8(),t.bool()&&(e.struct_337=t.bytes(t.u16(),11,9)),e.skillEffect=t.u32(),e.unk10=t.u8(),e.unk11=t.u16(),e.position=N(t),e.unk13=t.u8(),e}function Pi(t){let e=new f(t),n={};return n.unk0=e.u8(),n.trapData=Uu(e),n.unk2=e.u8(),n}var vi="PKTNewTrap",et=51471;function Ti(t){let e=new f(t),n={};return n.paralyzationMaxPoint=e.u32(),n.enable=e.bool(),n.hitCheckTime=e.u32(),n.paralyzationPoint=e.u32(),n.objectId=e.u64(),e.skip(1),n.decreasePoint=e.u32(),e.skip(1),n.noHitCheckTime=e.u32(),e.skip(1),n}var Ii="PKTParalyzationStateNotify",tt=55896;function Vu(t){let e={};return e.characterLevel=t.u16(),e.name=t.string(20),e.curHp=T(t),e.position=N(t),e.auths=t.u8(),e.classId=t.u16(),e.zoneInstId=t.u64(),e.unk7=t.u8(),e.gearLevel=t.f32(),e.unk9=t.u16(),e.zoneId=t.u32(),e.transitIndex=t.u32(),e.unk12=t.u8(),e.unk13=t.u8(),e.worldId=t.u8(),e.partyMemberNumber=t.u8(),e.characterId=t.u64(),e.unk17=t.u8(),e.maxHp=T(t),e.unk19=t.u8(),e}function Ei(t){let e=new f(t),n={};return n.partyInstanceId=e.u32(),n.memberDatas=e.array(e.u16(),()=>Vu(e),40),n.partyType=e.u8(),n.lootGrade=e.u32(),n.partyLootType=e.u8(),n.raidInstanceId=e.u32(),n}var xi="PKTPartyInfo",nt=17285;function Ni(t){let e=new f(t),n={};return n.name=e.string(20),n.partyInstanceId=e.u32(),n.partyLeaveType=e.u8(),n}var Di="PKTPartyLeaveResult",ot=44646;function gi(t){let e=new f(t),n={};return n.passiveStatusEffectList=e.array(e.u16(),()=>e.u32(),10),n.unk0_m=e.u8(),n.objectId=e.u64(),n}var Ri="PKTPartyPassiveStatusEffectAddNotify",at=26921;function wi(t){let e=new f(t),n={};return n.objectId=e.u64(),n.passiveStatusEffectList=e.array(e.u16(),()=>e.u32(),10),n}var Li="PKTPartyPassiveStatusEffectRemoveNotify",st=46564;function Ki(t){let e=new f(t),n={};return n.unk0=e.u64(),n.playerIdOnRefresh=e.u64(),n.unk2=e.u8(),n.statusEffectDatas=e.array(e.u16(),()=>H(e),80),n.characterId=e.u64(),n}var Ai="PKTPartyStatusEffectAddNotify",it=44546;function Bi(t){let e=new f(t),n={};return n.unk0=e.u64(),n.statusEffectIds=e.array(e.u16(),()=>e.u32(),80),n.reason=e.u8(),n.characterId=e.u64(),n}var Ci="PKTPartyStatusEffectRemoveNotify",rt=10041;function Mi(t){let e=new f(t),n={};return e.skip(8),n.raidInstanceId=e.u32(),e.skip(1),n.characterId=e.u64(),n.partyInstanceId=e.u32(),e.skip(17),n}var ji="PKTPartyStatusEffectResultNotify",ut=13786;function Oi(t){let e=new f(t),n={};return n.passiveStatusEffectList=e.array(e.u16(),()=>e.u32(),10),n}var Fi="PKTPassiveStatusEffectAddNotify",mt=53848;function qi(t){let e=new f(t),n={};return n.passiveStatusEffectList=e.array(e.u16(),()=>e.u32(),10),n}var Wi="PKTPassiveStatusEffectRemoveNotify",_t=56637;function Ui(t){let e=new f(t),n={};return n.endTick=e.u64(),n.unk6_m=e.u64(),n.raidResult=e.u8(),n.bossKillDataList=e.array(e.u16(),()=>nn(e),3),n.unk4_m=e.u64(),n.unk0_m=e.bool(),n.unk5_m=e.u64(),n.startTick=e.u64(),n.totalTime=e.u64(),n.braveHeartCount=e.u8(),n.raidId=e.u32(),n.initBraveHeartCount=e.u8(),n.unk1_m=e.bool(),n.unk11_m=e.bool(),n}var Vi="PKTRaidBegin",lt=22851;function Zi(t){let e=new f(t),n={};return e.skip(1),n.typeId=e.u32(),n}var zi="PKTRaidBossKillNotify",ft=38330;function Hi(t){let e=new f(t),n={};return n.struct_54=e.array(e.u16(),()=>{let o={};return o.unk1_0_0=T(e),o.unk1_0_1=e.u32(),o.unk1_0_2=T(e),o.struct_535=e.bytes(e.u16(),3),o},3),n.unk1=e.u64(),n.raidResult=e.u8(),n.unk3=e.u8(),n.unk4=e.u8(),n.unk5=e.u64(),n.unk6=e.u64(),n.unk7=e.u64(),n}var Gi="PKTRaidResult",ct=10064;function Zu(t){let e={};return e.unpublishReason=t.u8(),e.objectId=t.u64(),e}function Yi(t){let e=new f(t),n={};return n.unpublishedObjects=e.array(e.u16(),()=>Zu(e),200),n}var $i="PKTRemoveObject",dt=35384;function Ji(t){let e=new f(t),n={};return e.skip(1),n.skillId=e.u32(),n.newDirectionYaw=A(e),e.skip(1),n.cancelReason=e.u8(),n.newPosition=N(e),n.caster=e.u64(),n}var Qi="PKTSkillCancelNotify",pt=13094;function Xi(t){let e=new f(t),n={};return e.skip(1),n.skillId=e.u32(),n.caster=e.u64(),e.skip(1),n.skillLevel=e.u8(),n}var yi="PKTSkillCastNotify",ht=39612;function an(t){let e={};return e.maxHp=T(t),e.damageType=t.u8(),e.unk3_m=t.u16(),t.bool()&&(e.damageAttr=t.u8()),e.curHp=T(t),e.targetId=t.u64(),e.damage=T(t),e.modifier=t.u8(),e}function Hu(t){let e={};return e.skillMoveOptionData=$t(t),e.destination=N(t),e.unk8_m=t.u16(),e.unk4_m=t.u16(),e.skillDamageEvent=an(t),e.position=N(t),e.unk3_m=t.u16(),e.unk1_m=t.u8(),e.unk2_m=t.u64(),e}function er(t){let e=new f(t),n={};return n.unk2_m=e.u32(),n.unk1_m=e.u8(),n.skillDamageAbnormalMoveEvents=e.array(e.u16(),()=>Hu(e),50),n.skillEffectId=e.u32(),n.skillId=e.u32(),n.sourceId=e.u64(),n}var tr="PKTSkillDamageAbnormalMoveNotify",St=4102;function nr(t){let e=new f(t),n={};return e.bool()&&(n.unk1_0=e.u32()),n.skillId=e.u32(),n.sourceId=e.u64(),n.skillLevel=e.u8(),e.bool()&&(n.skillEffectId=e.u32()),n.skillDamageEvents=e.array(e.u16(),()=>an(e),50),n}var or="PKTSkillDamageNotify",kt=26079;function ar(t){let e=new f(t),n={};return e.skip(8),n.stage=e.u8(),n.skillId=e.u32(),e.skip(14),n.sourceId=e.u64(),e.skip(19),n}var sr="PKTSkillStageNotify",bt=10317;function ir(t){let e=new f(t),n={};return n.skillOptionData=Xt(e),n.newPosition=N(e),n.sourceId=e.u64(),n.aimTargetPosition=N(e),n.skillLevel=e.u8(),e.bool()&&(n.pitchRotation=A(e)),n.curPosition=N(e),e.bool()&&(n.aiStateId=e.u32()),n.newDirectionYaw=A(e),n.skillId=e.u32(),n.curDirectionYaw=A(e),e.bool()&&(n.unk1_m=e.u32()),n}var rr="PKTSkillStartNotify",Pt=53701;function ur(t){let e=new f(t),n={};return n.unk0=e.u8(),n.unk1=e.array(e.u16(),()=>{let o={};return o.value=T(e),o.statType=e.u8(),o},153),e.bool()&&(n.unk3_0=e.u32()),n.unk4=e.array(e.u16(),()=>{let o={};return o.value=T(e),o.statType=e.u8(),o},153),n.objectId=e.u64(),n}var mr="PKTStatChangeOriginNotify",_r=29922;function lr(t){let e=new f(t),n={};return n.objectId=e.u64(),n.unk1=e.u64(),n.statusEffectData=H(e),e.bool()&&(n.unk4_0=e.u64()),n.new=e.bool(),n}var fr="PKTStatusEffectAddNotify",vt=35829;function cr(t){let e=new f(t),n={};return n.statusEffectIds=e.array(e.u16(),()=>e.u32(),80),n.reason=e.u8(),n.objectId=e.u64(),n}var dr="PKTStatusEffectRemoveNotify",Tt=16493;function pr(t){let e=new f(t),n={};return e.skip(2),n.targetId=e.u64(),n.expirationTick=e.u64(),n.effectInstanceId=e.u32(),e.skip(2),n}var hr="PKTStatusEffectDurationNotify",It=40374;function Sr(t){let e=new f(t),n={};return e.skip(3),n.characterId=e.u64(),n.value=e.u32(),e.skip(4),n.objectId=e.u64(),n.effectInstanceId=e.u32(),n}var kr="PKTStatusEffectSyncDataNotify",Et=10020;function br(t){let e=new f(t),n={};return n.step=e.u32(),n.triggerId=e.u32(),e.skip(1),n.unk2_m=e.bool(),n}var Pr="PKTTriggerBossBattleStatus",xt=12536;function vr(t){let e=new f(t),n={};return n.packetResultCode=e.u32(),n.triggerId=e.u32(),n.unk0_m=e.u32(),n.involvedPCs=e.array(e.u16(),()=>e.u64(),40),n}var Tr="PKTTriggerFinishNotify",Nt=43956;function Ir(t){let e=new f(t),n={};return n.triggerId=e.u32(),n.involvedPCs=e.array(e.u16(),()=>e.u64(),40),n.sourceId=e.u64(),n.triggerSignalType=e.u32(),n}var Er="PKTTriggerStartNotify",Dt=7488;function xr(t){let e=new f(t),n={};return n.characterId=e.u64(),n.maxHp=T(e),n.position=e.u64(),n.unk0_m=e.u32(),n.curHp=T(e),n.statusEffectDatas=e.array(e.u16(),()=>H(e),80),n}var Nr="PKTTroopMemberUpdateMinNotify",gt=45338;function Dr(t){let e=new f(t),n={};return e.skip(1),n.identityGauge1=e.u32(),n.identityGauge2=e.u32(),n.identityGauge3=e.u32(),e.skip(3),n.playerId=e.u64(),n}var gr="PKTIdentityGaugeChangeNotify",Rt=2589;function Rr(t){let e=new f(t),n={};return n.totalMembers=e.array(e.u16(),()=>e.u64(),40),n.completeMembers=e.array(e.u16(),()=>e.u64(),40),n.zoneLevel=e.u8(),n.loadComplete=e.bool(),n.firstPCEnterTick=e.u64(),n.zoneId=e.u32(),n.zoneInstId=e.u64(),n}var wr="PKTZoneMemberLoadStatusNotify",wt=53608;function Lr(t){let e=new f(t),n={};return e.skip(2),n.objectId=e.u64(),e.skip(1),n}var Kr="PKTZoneObjectUnpublishNotify",Lt=9489;function Gu(t){let e={};return e.instanceId=t.u32(),t.skip(4),e.stackCount=t.u8(),e.id=t.u32(),e.target=t.u8(),e}function Ar(t){let e=new f(t),n={};return n.zoneStatusEffectDataList=e.array(e.u16(),()=>Gu(e),4),n}var Br="PKTZoneStatusEffectAddNotify",Kt=59381;function Cr(t){let e=new f(t),n={};return e.skip(1),n.statusEffectId=e.u32(),n}var Mr="PKTZoneStatusEffectRemoveNotify",At=7555;var jr=new Map([[Be,[ws,Rs]],[Ce,[As,Ks]],[Me,[Cs,Bs]],[je,[js,Ms]],[qs,[Fs,Os]],[Oe,[Us,Ws]],[Fe,[Zs,Vs]],[qe,[Hs,zs]],[We,[Ys,Gs]],[Ue,[Js,$s]],[Ve,[Xs,Qs]],[Ze,[ei,ys]],[ze,[ni,ti]],[He,[si,ai]],[Ge,[ri,ii]],[Ye,[mi,ui]],[$e,[li,_i]],[Je,[ci,fi]],[Qe,[pi,di]],[Xe,[Si,hi]],[ye,[bi,ki]],[et,[vi,Pi]],[tt,[Ii,Ti]],[nt,[xi,Ei]],[ot,[Di,Ni]],[at,[Ri,gi]],[st,[Li,wi]],[it,[Ai,Ki]],[rt,[Ci,Bi]],[ut,[ji,Mi]],[mt,[Fi,Oi]],[_t,[Wi,qi]],[lt,[Vi,Ui]],[ft,[zi,Zi]],[ct,[Gi,Hi]],[dt,[$i,Yi]],[pt,[Qi,Ji]],[ht,[yi,Xi]],[St,[tr,er]],[kt,[or,nr]],[bt,[sr,ar]],[Pt,[rr,ir]],[_r,[mr,ur]],[vt,[fr,lr]],[Tt,[dr,cr]],[It,[hr,pr]],[Et,[kr,Sr]],[xt,[Pr,br]],[Nt,[Tr,vr]],[Dt,[Er,Ir]],[gt,[Nr,xr]],[Rt,[gr,Dr]],[wt,[wr,Rr]],[Lt,[Kr,Lr]],[Kt,[Br,Ar]],[At,[Mr,Cr]]]);var $u=new Map([[Be,[101]],[Ce,[0]],[Me,[1]],[je,[2]],[Oe,[4]],[Fe,[5]],[qe,[6]],[Ze,[7]],[ze,[8]],[He,[9]],[Ye,[10]],[$e,[11]],[Je,[12]],[Qe,[13]],[Xe,[14]],[ye,[15]],[tt,[16]],[nt,[17]],[ot,[18]],[at,[19]],[st,[20]],[it,[21]],[rt,[22]],[ut,[23]],[mt,[24]],[_t,[25]],[ft,[26]],[ct,[27]],[dt,[28]],[St,[29]],[kt,[30]],[bt,[31]],[Pt,[32]],[vt,[34]],[Tt,[35]],[It,[36]],[Et,[37]],[xt,[38]],[Nt,[39]],[Dt,[40]],[gt,[41]],[Rt,[42]],[Lt,[43]],[Kt,[44]],[At,[45]],[ht,[46]],[Ve,[47]],[We,[48]],[Ue,[49]],[Ge,[50]],[lt,[52]],[wt,[51]],[et,[53]],[pt,[54]]]);var e_=require("tiny-typed-emitter");var sn=class{#e;#o;#i;#a;#n;#t;constructor(e,n,o,s,i,a){this.#e=e,this.#o=n,this.#i=o,this.#a=s,this.#n=i,this.#t=a}#s;get parsed(){if(!this.#s)try{this.#s=this.#t(this.#n.decrypt(this.#e,this.#o,this.#i,this.#a))}catch(e){console.error(`[meter-core/pkt-stream] - ${e}`);return}return this.#s}};var Qu=require("fs");var Or=class extends Ju.TypedEmitter{},rn=class extends Or{#e;#o;constructor(e,n,o){super(),this.#e=n,o&&(this.#o=(0,Qu.createWriteStream)(o,{highWaterMark:0}));let s=Buffer.allocUnsafe(dn);s.writeUIntLE(5,0,dn),this.#o?.write(s),e.on("*",this.handlePkt.bind(this))}handlePkt(e,n,o,s){try{let i=jr.get(n),a=$u.get(n);if(i&&a){let[m]=a,[c,l]=i,k=yt.get(m);if(k){let[h,v,G]=k,B=new sn(Buffer.from(e),n,o,!!s,this.#e,l).parsed;if(!B)return;let J=new oe(B,m,G);this.emit(h,J),this.emit("*",h,J),this.appendLog(J)}}}catch(i){console.error(i)}}appendLog(e){this.#o&&e.serialized&&this.#o.write(e.serialized)}};var un=class{characterIdToPartyId;entityIdToPartyId;raidInstanceToPartyInstances;ownName;characterNameToCharacterId;#e;constructor(e){this.characterIdToPartyId=new Map,this.entityIdToPartyId=new Map,this.raidInstanceToPartyInstances=new Map,this.characterNameToCharacterId=new Map,this.#e=e}add(e,n,o=void 0,s=void 0,i=void 0){!o&&!s||(o&&!s&&(s=this.#e.getEntityId(o)),s&&!o&&(o=this.#e.getEntityId(s)),o&&this.characterIdToPartyId.set(o,n),s&&this.entityIdToPartyId.set(s,n),i&&o&&this.characterNameToCharacterId.set(i,o),this.registerPartyId(e,n))}completeEntry(e,n){let o=this.getPartyIdFromCharacterId(e),s=this.getPartyIdFromEntityId(n);o&&s||(!o&&s&&this.characterIdToPartyId.set(e,s),!s&&o&&this.entityIdToPartyId.set(n,o))}changeEntityId(e,n){let o=this.getPartyIdFromEntityId(e);o&&(this.entityIdToPartyId.delete(e),this.entityIdToPartyId.set(n,o))}setOwnName(e){this.ownName=e}remove(e,n){if(n===this.ownName){this.removePartyMappings(e);return}let o=this.characterNameToCharacterId.get(n);if(this.characterNameToCharacterId.delete(n),!o)return;this.characterIdToPartyId.delete(o);let s=this.#e.getEntityId(o);s&&this.characterIdToPartyId.delete(s)}isCharacterInParty(e){return this.characterIdToPartyId.has(e)}isEntityInParty(e){return this.entityIdToPartyId.has(e)}getPartyIdFromCharacterId(e){return this.characterIdToPartyId.get(e)}getPartyIdFromEntityId(e){return this.entityIdToPartyId.get(e)}removePartyMappings(e){let n=this.getRaidInstanceId(e),o=n?this.raidInstanceToPartyInstances.get(n)??new Set([e]):new Set([e]);for(let[s,i]of this.characterIdToPartyId)if(o.has(i)){this.characterIdToPartyId.delete(s);for(let[a,m]of this.characterNameToCharacterId)if(s===m){this.characterNameToCharacterId.delete(a);break}}for(let[s,i]of this.entityIdToPartyId)o.has(i)&&this.entityIdToPartyId.delete(s)}getRaidInstanceId(e){for(let n of this.raidInstanceToPartyInstances)if(n[1].has(e))return n[0]}registerPartyId(e,n){let o=this.raidInstanceToPartyInstances.get(e);o||(o=new Set,this.raidInstanceToPartyInstances.set(e,o)),o.add(n)}partyInfo(e,n,o){let s=e.parsed;if(s){if(s.memberDatas.length===1&&s.memberDatas[0]?.name===o.name){this.remove(s.partyInstanceId,s.memberDatas[0].name);return}this.removePartyMappings(s.partyInstanceId);for(let i of s.memberDatas){i.characterId===o.characterId&&this.setOwnName(i.name);let a=this.#e.getEntityId(i.characterId);if(a){let m=n.get(a);if(m&&m.entityType===1&&m.name!==i.name){let c=m;c.gearLevel=i.gearLevel,c.name=i.name,c.class=i.classId}}this.add(s.raidInstanceId,s.partyInstanceId,i.characterId,a,i.name)}}}};var mn=class{entityToCharacterId;characterToEntityId;constructor(){this.entityToCharacterId=new Map,this.characterToEntityId=new Map}addMapping(e,n){this.entityToCharacterId.set(n,e),this.characterToEntityId.set(e,n)}getCharacterId(e){return this.entityToCharacterId.get(e)}getEntityId(e){return this.characterToEntityId.get(e)}clear(){this.entityToCharacterId.clear(),this.characterToEntityId.clear()}};var Fr=class extends yu.TypedEmitter{#e;#o;#i;#a;#n;#t;#s;#r;#u;#m;constructor(e,n,o,s){super(),this.#e=e,this.#o=n,this.#i=new mn,this.#a=new un(this.#i),this.#n=new ge(this.#a,this.#o,s.isLive??!0),this.#t=new Vt(this.#i,this.#a,this.#n,this.#o),this.#r=new Ke(this.#t,o,Xu(this.#e,s.isLive)?this.#e:void 0),this.#s=new en(this.#t,this.#n,this.#r,this.#o,s),this.#s.emit=this.emit.bind(this),this.#u=!1,this.#m=!1,this.#s.options.isLive&&setInterval(this.broadcastStateChange.bind(this),100),this.#e.on("APP_StatApi",i=>{let a=i.parsed;a&&this.#r.updatePlayerStats(a.players)}).on("AbilityChangeNotify",i=>{}).on("ActiveAbilityNotify",i=>{}).on("AddonSkillFeatureChangeNotify",i=>{}).on("BlockSkillStateNotify",i=>{}).on("CounterAttackNotify",i=>{let a=i.parsed;if(!a)return;let m=this.#t.entities.get(a.sourceId);m&&this.#s.onCounterAttack(m,i.time)}).on("DeathNotify",i=>{let a=i.parsed;if(!a)return;let m=this.#t.entities.get(a.targetId);m&&this.#s.onDeath(m,i.time)}).on("EquipChangeNotify",i=>{let a=i.parsed;if(!a)return;let m=this.#t.entities.get(a.objectId);if(!m||m.entityType!==1)return;m.itemSet=this.#t.getPlayerSetOptions(a.equipItemDataList);let c=[];a.equipItemDataList.forEach(l=>{l.id!==void 0&&l.slot!==void 0&&c.push({id:l.id,slot:l.slot})}),m.items.equipList=c}).on("EquipLifeToolChangeNotify",i=>{let a=i.parsed;if(!a)return;let m=this.#t.entities.get(a.objectId);if(!m||m.entityType!==1)return;let c=[];a.equipLifeToolDataList.forEach(l=>{l.id!==void 0&&l.slot!==void 0&&c.push({id:l.id,slot:l.slot})}),m.items.lifeToolList=c}).on("IdentityStanceChangeNotify",i=>{let a=i.parsed;if(!a)return;let m=this.#t.entities.get(a.objectId);m&&m.entityType===1&&(m.stance=a.stance)}).on("IdentityGaugeChangeNotify",i=>{}).on("InitAbility",i=>{}).on("InitEnv",i=>{this.#t.processInitEnv(i),this.#s.onInitEnv(i,i.time)}).on("InitLocal",i=>{}).on("InitPC",i=>{let a=this.#t.processInitPC(i);if(a&&i.parsed){let m=this.#o.getStatPairMap(i.parsed.statPair);this.#s.updateOrCreateEntity(a,{id:a.entityId.toString(16),name:a.name,classId:a.class,isPlayer:!0,gearScore:a.gearLevel,currentHp:Number(m.get(1))||0,maxHp:Number(m.get(27))||0},i.time)}}).on("InitItem",i=>{let a=i.parsed;if(a){if([1,20].includes(a.storageType)){this.#t.localPlayer.itemSet=this.#t.getPlayerSetOptions(a.itemDataList);let m=[];a.itemDataList.forEach(c=>{c.id!==void 0&&c.slot!==void 0&&m.push({id:c.id,slot:c.slot})}),this.#t.localPlayer.items.equipList=m}else if(a.storageType===21){let m=[];a.itemDataList.forEach(c=>{c.id!==void 0&&c.slot!==void 0&&m.push({id:c.id,slot:c.slot})}),this.#t.localPlayer.items.lifeToolList=m}}}).on("MigrationExecute",i=>{this.#r.zoneSyncStatus=0;let a=i.parsed;a&&(this.#t.localPlayer.characterId===0n&&(this.#t.localPlayer.characterId=a.account_CharacterId1<a.account_CharacterId2?a.account_CharacterId1:a.account_CharacterId2),this.#r.ip=i.parsed.serverAddr.split(":")[0])}).on("NewNpc",i=>{let a=this.#t.processNewNpc(i);if(a&&i.parsed){let m=this.#o.getStatPairMap(i.parsed.npcStruct.statPair);this.#s.updateOrCreateEntity(a,{id:a.entityId.toString(16),name:a.name,npcId:a.typeId,isPlayer:!1,isBoss:a.isBoss,currentHp:Number(m.get(1))||0,maxHp:Number(m.get(27))||0},i.time)}}).on("NewNpcSummon",i=>{let a=this.#t.processNewNpcSummon(i);if(a&&i.parsed){let m=this.#o.getStatPairMap(i.parsed.npcData.statPair);this.#s.updateOrCreateEntity(a,{id:a.entityId.toString(16),name:a.name,npcId:a.typeId,isPlayer:!1,isBoss:a.isBoss,currentHp:Number(m.get(1))||0,maxHp:Number(m.get(27))||0},i.time)}}).on("NewPC",i=>{let a=this.#t.processNewPC(i);if(a&&i.parsed){let m=this.#o.getStatPairMap(i.parsed.pcStruct.statPair);this.#s.updateOrCreateEntity(a,{id:a.entityId.toString(16),name:a.name,classId:a.class,isPlayer:!0,gearScore:a.gearLevel,currentHp:Number(m.get(1))||0,maxHp:Number(m.get(27))||0},i.time)}}).on("NewProjectile",i=>{let a=i.parsed;if(!a)return;let m={entityId:a.projectileInfo.projectileId,entityType:5,name:a.projectileInfo.projectileId.toString(16),ownerId:a.projectileInfo.ownerId,skillEffectId:a.projectileInfo.skillEffect,skillId:a.projectileInfo.skillId,stats:new Map};this.#t.entities.set(m.entityId,m)}).on("NewTrap",i=>{let a=i.parsed;if(!a)return;let m={entityId:a.trapData.objectId,entityType:5,name:a.trapData.objectId.toString(16),ownerId:a.trapData.ownerId,skillEffectId:a.trapData.skillEffect,skillId:a.trapData.skillId,stats:new Map};this.#t.entities.set(m.entityId,m)}).on("ParalyzationStateNotify",i=>{}).on("PartyInfo",i=>{this.#a.partyInfo(i,this.#t.entities,this.#t.localPlayer)}).on("PartyLeaveResult",i=>{let a=i.parsed;a&&this.#a.remove(a.partyInstanceId,a.name)}).on("PartyPassiveStatusEffectAddNotify",i=>{}).on("PartyPassiveStatusEffectRemoveNotify",i=>{}).on("PartyStatusEffectAddNotify",i=>{let a=i.parsed;if(a)for(let m of a.statusEffectDatas){let c=a.playerIdOnRefresh!==0n?a.playerIdOnRefresh:m.sourceId,l=this.#t.getSourceEntity(c);this.#n.RegisterStatusEffect(this.#n.buildStatusEffect(m,a.characterId,l.entityId,0,i.time))}}).on("PartyStatusEffectRemoveNotify",i=>{let a=i.parsed;if(a)for(let m of a.statusEffectIds){let c=this.#n.RemoveStatusEffect(a.characterId,m,0,a.reason,i.time);c&&c.statusEffectId===9701&&this.#r.syncData()}}).on("PartyStatusEffectResultNotify",i=>{let a=i.parsed;a&&this.#a.add(a.raidInstanceId,a.partyInstanceId,a.characterId)}).on("PassiveStatusEffectAddNotify",i=>{}).on("PassiveStatusEffectRemoveNotify",i=>{}).on("RaidBegin",i=>{let a=i.parsed;a&&(this.#o.statQueryFilter.raid.has(a.raidId)?this.#r.zoneSyncStatus|=16:this.#r.zoneSyncStatus|=8)}).on("ZoneMemberLoadStatusNotify",i=>{let a=i.parsed;a&&(this.#s.setZoneLevel(a.zoneLevel),this.#o.statQueryFilter.zone.has(a.zoneId)&&[0,1,5].includes(a.zoneLevel)?this.#r.zoneSyncStatus|=4:this.#r.zoneSyncStatus|=2)}).on("RaidBossKillNotify",i=>{this.#s.setKillState(1),this.#s.onPhaseTransition(1,i.time)}).on("RaidResult",i=>{i.parsed?.raidResult===1&&this.#s.setKillState(1),this.#s.onPhaseTransition(0,i.time)}).on("RemoveObject",i=>{let a=i.parsed;if(a)for(let m of a.unpublishedObjects)this.#n.RemoveLocalObject(m.objectId,i.time)}).on("SkillCastNotify",i=>{let a=i.parsed;if(!a)return;let m=this.#t.getSourceEntity(a.caster);m=this.#t.guessIsPlayer(m,a.skillId),this.#s.onStartSkill(m,a.skillId,i.time)}).on("SkillDamageAbnormalMoveNotify",i=>{let a=i.parsed;if(!a)return;let m=this.#t.getSourceEntity(a.sourceId);a.skillDamageAbnormalMoveEvents.forEach(c=>{let l=this.#t.getOrCreateEntity(c.skillDamageEvent.targetId),k=this.#t.getOrCreateEntity(a.sourceId);l.stats.set(1,c.skillDamageEvent.curHp),l.stats.set(27,c.skillDamageEvent.maxHp),this.#s.onDamage(m,k,l,{skillId:a.skillId,skillEffectId:a.skillEffectId,damage:Number(c.skillDamageEvent.damage),modifier:c.skillDamageEvent.modifier,targetCurHp:Number(c.skillDamageEvent.curHp),targetMaxHp:Number(c.skillDamageEvent.maxHp),damageAttr:c.skillDamageEvent.damageAttr??0,damageType:c.skillDamageEvent.damageType},a.skillDamageAbnormalMoveEvents.length,i.time)})}).on("SkillDamageNotify",i=>{let a=i.parsed;if(!a)return;let m=this.#t.getSourceEntity(a.sourceId);a.skillDamageEvents.forEach(c=>{let l=this.#t.getOrCreateEntity(c.targetId),k=this.#t.getOrCreateEntity(a.sourceId);this.#s.onDamage(m,k,l,{skillId:a.skillId,skillEffectId:a.skillEffectId??0,damage:Number(c.damage),modifier:c.modifier,targetCurHp:Number(c.curHp),targetMaxHp:Number(c.maxHp),damageAttr:c.damageAttr??0,damageType:c.damageType},a.skillDamageEvents.length,i.time)})}).on("SkillStageNotify",i=>{}).on("SkillStartNotify",i=>{let a=i.parsed;if(!a)return;let m=this.#t.getSourceEntity(a.sourceId);if(m=this.#t.guessIsPlayer(m,a.skillId),m.entityType===1){let c=m,l=c.skills.get(a.skillId);if(l||(l={effects:new Set,tripods:new Map},c.skills.set(a.skillId,l)),l.level=a.skillLevel,a.skillOptionData.tripodIndex&&a.skillOptionData.tripodLevel){l.tripods||(l.tripods=new Map);for(let[k,h]of["first","second","third"].entries()){if(a.skillOptionData.tripodIndex[h]===0){for(let j=1;j<=3;j++)l.tripods.delete(3*k+j);continue}let v=3*k+a.skillOptionData.tripodIndex[h],G=a.skillOptionData.tripodLevel[h],L=l.tripods.get(v);if(L&&G===L.level)continue;for(let j=1;j<=3;j++)l.tripods.delete(3*k+j);let B=this.#o.skillFeature.get(a.skillId)?.get(v),J=[];B&&B.entries.forEach(j=>{j.level!==0&&j.level!==G||J.push(j)}),l.tripods.set(v,{level:a.skillOptionData.tripodLevel[h],options:J.sort((j,Bt)=>Bt.level-j.level)})}}}this.#s.onStartSkill(m,a.skillId,i.time)}).on("StatusEffectAddNotify",i=>{let a=i.parsed;if(!a)return;let m=this.#t.getSourceEntity(a.statusEffectData.sourceId);this.#n.RegisterStatusEffect(this.#n.buildStatusEffect(a.statusEffectData,a.objectId,m.entityId,1,i.time))}).on("StatusEffectDurationNotify",i=>{let a=i.parsed;a&&this.#n.UpdateDuration(a.effectInstanceId,a.targetId,a.expirationTick,1)}).on("StatusEffectRemoveNotify",i=>{let a=i.parsed;if(a)for(let m of a.statusEffectIds){let c=this.#n.RemoveStatusEffect(a.objectId,m,1,a.reason,i.time);c&&c.statusEffectId===9701&&this.#r.syncData()}}).on("StatusEffectSyncDataNotify",i=>{let a=i.parsed;a&&this.#n.SyncStatusEffect(a.effectInstanceId,a.characterId,a.objectId,a.value,this.#t.localPlayer.characterId)}).on("TriggerBossBattleStatus",i=>{this.#s.onPhaseTransition(2,i.time)}).on("TriggerFinishNotify",i=>{}).on("TriggerStartNotify",i=>{let a=i.parsed;if(a)switch(a.triggerSignalType){case 57:case 59:case 61:case 63:case 74:case 76:this.#s.setKillState(1);break;case 58:case 60:case 62:case 64:case 75:case 77:this.#s.setKillState(0);break;case 27:case 10:case 11:this.#r.syncData()}}).on("TroopMemberUpdateMinNotify",i=>{}).on("ZoneObjectUnpublishNotify",i=>{let a=i.parsed;a&&this.#n.RemoveLocalObject(a.objectId,i.time)}).on("ZoneStatusEffectAddNotify",i=>{}).on("TroopMemberUpdateMinNotify",i=>{let a=i.parsed;if(a&&a.statusEffectDatas.length>0)for(let m of a.statusEffectDatas){let c=this.#i.getEntityId(a.characterId),l=m.value?m.value.readUInt32LE():0,k=m.value?m.value.readUInt32LE(8):0,h=l<k?l:k;this.#n.SyncStatusEffect(m.effectInstanceId,a.characterId,c,h,this.#t.localPlayer.characterId)}}).on("ZoneStatusEffectRemoveNotify",i=>{}),this.#n.on("shieldApplied",i=>{let a=i.targetId;if(i.type===0&&(a=this.#i.getEntityId(i.targetId)??a),a===void 0)return;let m=this.#t.getSourceEntity(i.sourceId),c=this.#t.getOrCreateEntity(a);this.#s.onShieldApplied(c,m,i.statusEffectId,i.value)}).on("shieldChanged",(i,a,m)=>{let c=i.targetId;if(i.type===0&&(c=this.#i.getEntityId(i.targetId)??c),c===void 0)return;let l=this.#t.getSourceEntity(i.sourceId),k=this.#t.getOrCreateEntity(c);this.#s.onShieldUsed(k,l,i.statusEffectId,a-m)})}broadcastStateChange(){this.emit("state-change",this.#s.getBroadcast())}reset(){this.#s.resetState(+new Date)}cancelReset(){this.#s.cancelReset()}updateOptions(e){this.#s.updateOptions(e)}onConnect(e){this.#r.ip||(this.#r.ip=e.split(":")[0],Xu(this.#e,this.#s.options.isLive)&&this.#e.appendLog(new oe({account_CharacterId1:0n,serverAddr:e,account_CharacterId2:0n},11,Le)))}get encounters(){return this.#s.splitEncounter(new Date),this.#s.encounters}};function Xu(t,e){return t instanceof rn||t.appendLog&&e}0&&(module.exports={Parser});
